(self.webpackChunkmspr_arosaje_strapi=self.webpackChunkmspr_arosaje_strapi||[]).push([[8155],{97259:($,L,r)=>{"use strict";r.r(L),r.d(L,{default:()=>Ke});var e=r(53547),I=r(17034),k=r(185),j=r(53979),C=r(29728),se=r(49066),le=r(77197),R=r(42609),re=r(85018),F=r(41054),g=r(86896),n=r(88767),a=r(86706),s=r(27887);function E(t,o){const l=(0,a.oR)();(0,e.useEffect)(()=>{l.injectReducer(t,o)},[l,t,o])}var h=r(87751),i=r(53616);function m({status:t,data:o}){return{type:i.QM,payload:{status:t,workflows:o}}}function p(t){return{type:i.x4,payload:{stageId:t}}}function w(t={}){return{type:i.Ot,payload:t}}function b(t,o){return{type:i.Nj,payload:{stageId:t,...o}}}function T(t,o){return{type:i.$k,payload:{newIndex:o,oldIndex:t}}}var v=r(11047),A=r(84170),z=r(12645),H=r(45697),S=r.n(H),O=r(88972);const ae=(0,O.ZP)(v.k)`
  svg path {
    fill: ${({theme:t})=>t.colors.neutral600};
  }
`;function X({name:t}){return e.createElement(v.k,{background:"primary100",borderStyle:"dashed",borderColor:"primary600",borderWidth:"1px",gap:3,hasRadius:!0,padding:3,shadow:"tableShadow",width:(0,R.pxToRem)(300)},e.createElement(ae,{alignItems:"center",background:"neutral200",borderRadius:"50%",height:6,justifyContent:"center",width:6},e.createElement(z.Z,{width:`${8/16}rem`})),e.createElement(A.Z,{fontWeight:"bold"},t))}X.propTypes={name:S().string.isRequired};var M=r(41580),ne=r(99782);const Q=(0,O.ZP)(ne.Z)`
  > circle {
    fill: ${({theme:t})=>t.colors.neutral150};
  }
  > path {
    fill: ${({theme:t})=>t.colors.neutral600};
  }
`,Y=(0,O.ZP)(M.x)`
  border-radius: 26px;

  svg {
    height: ${({theme:t})=>t.spaces[6]};
    width: ${({theme:t})=>t.spaces[6]};

    > path {
      fill: ${({theme:t})=>t.colors.neutral600};
    }
  }

  &:hover {
    color: ${({theme:t})=>t.colors.primary600} !important;
    ${A.Z} {
      color: ${({theme:t})=>t.colors.primary600} !important;
    }

    ${Q} {
      > circle {
        fill: ${({theme:t})=>t.colors.primary600};
      }
      > path {
        fill: ${({theme:t})=>t.colors.neutral100};
      }
    }
  }

  &:active {
    ${A.Z} {
      color: ${({theme:t})=>t.colors.primary600};
    }

    ${Q} {
      > circle {
        fill: ${({theme:t})=>t.colors.primary600};
      }
      > path {
        fill: ${({theme:t})=>t.colors.neutral100};
      }
    }
  }
`;function fe({children:t,...o}){return e.createElement(Y,{as:"button",background:"neutral0",border:"neutral150",paddingBottom:3,paddingLeft:4,paddingRight:4,paddingTop:3,shadow:"filterShadow",...o},e.createElement(v.k,{gap:2},e.createElement(Q,{"aria-hidden":!0}),e.createElement(A.Z,{variant:"pi",fontWeight:"bold",textColor:"neutral500"},t)))}fe.propTypes={children:S().node.isRequired};var Ee=r(63237),be=r(48734),Ce=r(74756),me=r(12028),Re=r(63081),We=r(11276),pe=r(67819),De=r(16364),ve=r(70642),xe=r(20022),Ie=r(12814),Te=r(61080),Me=r(75642),$e=r(13920),ie=r(75156);const Ae=(0,ie.s)();function Oe(){return e.createElement(M.x,{background:"primary100",borderStyle:"dashed",borderColor:"primary600",borderWidth:"1px",display:"block",hasRadius:!0,padding:6,shadow:"tableShadow"})}function he({id:t,index:o,canDelete:l,canReorder:W,isOpen:f=!1,stagesCount:d}){const c=u=>`${u+1} of ${d}`,y=u=>{U(D({id:"dnd.grab-item",defaultMessage:"{item}, grabbed. Current position in list: {position}. Press up and down arrow to change position, Spacebar to drop, Escape to cancel."},{item:x.value,position:c(u)}))},Z=u=>{U(D({id:"dnd.drop-item",defaultMessage:"{item}, dropped. Final position in list: {position}."},{item:x.value,position:c(u)}))},ue=()=>{U(D({id:"dnd.cancel-item",defaultMessage:"{item}, dropped. Re-order cancelled."},{item:x.value}))},B=(u,te)=>{U(D({id:"dnd.reorder",defaultMessage:"{item}, moved. New position in list: {position}."},{item:x.value,position:c(u)})),G(T(te,u))},[oe,U]=e.useState(null),{formatMessage:D}=(0,g.Z)(),{trackUsage:q}=(0,R.useTracking)(),G=(0,a.I0)(),[K,de]=e.useState(f),[x,ge]=(0,F.U$)(`stages.${o}.name`),[N,_]=(0,F.U$)(`stages.${o}.color`),[{handlerId:P,isDragging:ee,handleKeyDown:V},Ve,He,Xe,ye]=(0,Me.Y9)(W,{index:o,item:{name:x.value},onGrabItem:y,onDropItem:Z,onMoveItem:B,onCancel:ue,type:i.uL.STAGE}),Qe=(0,$e.FE)(Ve,He),Ye=Ae.map(({hex:u,name:te})=>({value:u,label:D({id:"Settings.review-workflows.stage.color.name",defaultMessage:"{name}"},{name:te}),color:u}));e.useEffect(()=>{ye((0,Te.rX)(),{captureDraggingState:!1})},[ye,o]);const{themeColorName:Je}=N.value?(0,ie.k)(N.value):{};return e.createElement(M.x,{ref:Qe},oe&&e.createElement(Ee.T,{"aria-live":"assertive"},oe),ee?e.createElement(Oe,null):e.createElement(be.U,{size:"S",variant:"primary",onToggle:()=>{de(!K),K||q("willEditStage")},expanded:K,shadow:"tableShadow"},e.createElement(Ce.B,{title:x.value,togglePosition:"left",action:e.createElement(v.k,null,l&&e.createElement(me.h,{background:"transparent",icon:e.createElement(xe.Z,null),label:D({id:"Settings.review-workflows.stage.delete",defaultMessage:"Delete stage"}),noBorder:!0,onClick:()=>G(p(t))}),e.createElement(me.h,{background:"transparent",forwardedAs:"div",role:"button",noBorder:!0,tabIndex:0,"data-handler-id":P,ref:Xe,label:D({id:"Settings.review-workflows.stage.drag",defaultMessage:"Drag"}),onClick:u=>u.stopPropagation(),onKeyDown:V},e.createElement(Ie.Z,null)))}),e.createElement(Re.v,{padding:6,background:"neutral0",hasRadius:!0},e.createElement(We.r,{gap:4},e.createElement(pe.P,{col:6},e.createElement(De.o,{...x,id:x.name,label:D({id:"Settings.review-workflows.stage.name.label",defaultMessage:"Stage name"}),error:ge.error??!1,onChange:u=>{x.onChange(u),G(b(t,{name:u.target.value}))},required:!0})),e.createElement(pe.P,{col:6},e.createElement(ve.q4,{error:_?.error??!1,id:N.name,required:!0,label:D({id:"content-manager.reviewWorkflows.stage.color",defaultMessage:"Color"}),onChange:u=>{N.onChange({target:{value:u}}),G(b(t,{color:u}))},value:N.value.toUpperCase(),startIcon:e.createElement(v.k,{as:"span",height:2,background:N.value,borderColor:Je==="neutral0"?"neutral150":"transparent",hasRadius:!0,shrink:0,width:2})},Ye.map(({value:u,label:te,color:ke})=>{const{themeColorName:qe}=(0,ie.k)(ke);return e.createElement(ve.ag,{value:u,key:u,startIcon:e.createElement(v.k,{as:"span",height:2,background:ke,borderColor:qe==="neutral0"?"neutral150":"transparent",hasRadius:!0,shrink:0,width:2})},te)})))))))}he.propTypes=S().shape({id:S().number.isRequired,color:S().string.isRequired,canDelete:S().bool.isRequired,canReorder:S().bool.isRequired,stagesCount:S().number.isRequired}).isRequired;const Pe=(0,O.ZP)(M.x)`
  position: relative;
`,Le=(0,O.ZP)(M.x)`
  left: 50%;
  position: absolute;
  top: 0;
  transform: translateX(-50%);
`;function ce({stages:t}){const{formatMessage:o}=(0,g.Z)(),l=(0,a.I0)(),{trackUsage:W}=(0,R.useTracking)();return e.createElement(v.k,{direction:"column",gap:6,width:"100%"},e.createElement(Pe,{spacing:4,width:"100%"},e.createElement(Le,{background:"neutral200",height:"100%",width:2,zIndex:1}),e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:6,zIndex:2,position:"relative",as:"ol"},t.map((f,d)=>{const c=f?.id??f.__temp_key__;return e.createElement(M.x,{key:`stage-${c}`,as:"li"},e.createElement(he,{id:c,index:d,canDelete:t.length>1,isOpen:!f.id,canReorder:t.length>1,stagesCount:t.length}))}))),e.createElement(v.k,{direction:"column",gap:6},e.createElement(fe,{type:"button",onClick:()=>{l(w({name:""})),W("willCreateStage")}},o({id:"Settings.review-workflows.stage.add",defaultMessage:"Add new stage"}))))}ce.defaultProps={stages:[]},ce.propTypes={stages:S().arrayOf(S().shape({id:S().number,__temp_key__:S().number,name:S().string.isRequired}))};var Ne=r(53752),we=r(18172),je=r(18446),Ze=r.n(je);const Se={status:"loading",serverState:{currentWorkflow:null,workflows:[]},clientState:{currentWorkflow:{data:null,isDirty:!1,hasDeletedServerStages:!1}}};function Fe(t=Se,o){return(0,we.Uy)(t,l=>{const{payload:W}=o;switch(o.type){case i.QM:{const{status:f,workflows:d}=W;if(l.status=f,d?.length>0){let c=d[0];c={...c,stages:c.stages.map(y=>({...y,color:y?.color??i.FT}))},l.serverState.workflows=d,l.serverState.currentWorkflow=c,l.clientState.currentWorkflow.data=c,l.clientState.currentWorkflow.hasDeletedServerStages=!1}break}case i.x4:{const{stageId:f}=W,{currentWorkflow:d}=t.clientState;l.clientState.currentWorkflow.data.stages=d.data.stages.filter(c=>(c?.id??c.__temp_key__)!==f),d.hasDeletedServerStages||(l.clientState.currentWorkflow.hasDeletedServerStages=!!t.serverState.currentWorkflow.stages.find(c=>c.id===f));break}case i.Ot:{const{currentWorkflow:f}=t.clientState;f.data||(l.clientState.currentWorkflow.data={stages:[]});const d=ze(l.clientState.currentWorkflow.data.stages);l.clientState.currentWorkflow.data.stages.push({...W,color:W?.color??i.FT,__temp_key__:d});break}case i.Nj:{const{currentWorkflow:f}=t.clientState,{stageId:d,...c}=W;l.clientState.currentWorkflow.data.stages=f.data.stages.map(y=>(y.id??y.__temp_key__)===d?{...y,...c}:y);break}case i.$k:{const{currentWorkflow:{data:{stages:f}}}=t.clientState,{newIndex:d,oldIndex:c}=W;if(d>=0&&d<f.length){const y=f[c];let Z=[...f];Z.splice(c,1),Z.splice(d,0,y),l.clientState.currentWorkflow.data.stages=Z}break}default:break}t.clientState.currentWorkflow.data&&(l.clientState.currentWorkflow.isDirty=!Ze()((0,we.Vk)(l.clientState.currentWorkflow).data,l.serverState.currentWorkflow))})}const ze=(t=[])=>{const o=t.map(l=>l.id??l.__temp_key__);return Math.max(...o,-1)+1};var J=r(87561);function Be({formatMessage:t}){return J.Ry({stages:J.IX().of(J.Ry().shape({name:J.Z_().required(t({id:"Settings.review-workflows.validation.stage.name",defaultMessage:"Name is required"})).max(255,t({id:"Settings.review-workflows.validation.stage.max-length",defaultMessage:"Name can not be longer than 255 characters"})),color:J.Z_().required(t({id:"Settings.review-workflows.validation.stage.color",defaultMessage:"Color is required"})).matches(/^#(?:[0-9a-fA-F]{3}){1,2}$/i)}))})}function Ue({type:t,item:o}){switch(t){case i.uL.STAGE:return e.createElement(X,{...o});default:return null}}function Ge(){const{trackUsage:t}=(0,R.useTracking)(),{formatMessage:o}=(0,g.Z)(),l=(0,a.I0)(),{put:W}=(0,R.useFetchClient)(),{formatAPIError:f}=(0,R.useAPIErrorHandler)(),d=(0,R.useNotification)(),{workflows:c,status:y,refetch:Z}=(0,Ne.n)(),{status:ue,clientState:{currentWorkflow:{data:B,isDirty:oe,hasDeletedServerStages:U}}}=(0,a.v9)(P=>P?.[i.sN]??Se),[D,q]=(0,e.useState)(!1),{mutateAsync:G,isLoading:K}=(0,n.useMutation)(async({workflowId:P,stages:ee})=>{const{data:{data:V}}=await W(`/admin/review-workflows/workflows/${P}/stages`,{data:ee});return V},{onSuccess(){d({type:"success",message:{id:"notification.success.saved",defaultMessage:"Saved"}})}}),de=async(P,ee)=>{try{return await G({workflowId:P,stages:ee})}catch(V){return d({type:"warning",message:f(V)}),null}},x=async()=>{await de(B.id,B.stages),await Z(),q(!1)},ge=async()=>{await x()},N=()=>{q(P=>!P)},_=(0,F.TA)({enableReinitialize:!0,initialValues:B,async onSubmit(){U?q(!0):x()},validationSchema:Be({formatMessage:o}),validateOnChange:!1});return E(i.sN,Fe),(0,e.useEffect)(()=>{l(m({status:y,data:c}))},[y,c,l]),(0,e.useEffect)(()=>{t("didViewWorkflow")},[]),e.createElement(R.CheckPagePermissions,{permissions:h.Z.settings["review-workflows"].main},e.createElement(I.A,null,e.createElement(R.SettingsPageTitle,{name:o({id:"Settings.review-workflows.page.title",defaultMessage:"Review Workflows"})}),e.createElement(k.o,{tabIndex:-1},e.createElement(s.r,{renderItem:Ue}),e.createElement(F.Hy,{value:_},e.createElement(F.l0,{onSubmit:_.handleSubmit},e.createElement(j.T,{primaryAction:e.createElement(C.z,{startIcon:e.createElement(re.Z,null),type:"submit",size:"M",disabled:!oe,loading:!D&&K},o({id:"global.save",defaultMessage:"Save"})),title:o({id:"Settings.review-workflows.page.title",defaultMessage:"Review Workflows"}),subtitle:o({id:"Settings.review-workflows.page.subtitle",defaultMessage:"{count, plural, one {# stage} other {# stages}}"},{count:B?.stages?.length??0})}),e.createElement(se.D,null,ue==="loading"&&e.createElement(le.a,null,o({id:"Settings.review-workflows.page.isLoading",defaultMessage:"Workflow is loading"})),e.createElement(ce,{stages:_.values?.stages})))),e.createElement(R.ConfirmDialog,{bodyText:{id:"Settings.review-workflows.page.delete.confirm.body",defaultMessage:"All entries assigned to deleted stages will be moved to the previous stage. Are you sure you want to save?"},isConfirmButtonLoading:K,isOpen:D,onToggleDialog:N,onConfirm:ge}))))}const Ke=Ge},51584:($,L,r)=>{var e=r(44239),I=r(37005),k="[object Boolean]";function j(C){return C===!0||C===!1||I(C)&&e(C)==k}$.exports=j},7654:($,L,r)=>{var e=r(81763);function I(k){return e(k)&&k!=+k}$.exports=I},81763:($,L,r)=>{var e=r(44239),I=r(37005),k="[object Number]";function j(C){return typeof C=="number"||I(C)&&e(C)==k}$.exports=j},7334:($,L,r)=>{var e=r(79833);function I(k){return e(k).toLowerCase()}$.exports=I},20573:($,L,r)=>{"use strict";r.d(L,{P1:()=>re});var e="NOT_FOUND";function I(g){var n;return{get:function(s){return n&&g(n.key,s)?n.value:e},put:function(s,E){n={key:s,value:E}},getEntries:function(){return n?[n]:[]},clear:function(){n=void 0}}}function k(g,n){var a=[];function s(m){var p=a.findIndex(function(b){return n(m,b.key)});if(p>-1){var w=a[p];return p>0&&(a.splice(p,1),a.unshift(w)),w.value}return e}function E(m,p){s(m)===e&&(a.unshift({key:m,value:p}),a.length>g&&a.pop())}function h(){return a}function i(){a=[]}return{get:s,put:E,getEntries:h,clear:i}}var j=function(n,a){return n===a};function C(g){return function(a,s){if(a===null||s===null||a.length!==s.length)return!1;for(var E=a.length,h=0;h<E;h++)if(!g(a[h],s[h]))return!1;return!0}}function se(g,n){var a=typeof n=="object"?n:{equalityCheck:n},s=a.equalityCheck,E=s===void 0?j:s,h=a.maxSize,i=h===void 0?1:h,m=a.resultEqualityCheck,p=C(E),w=i===1?I(p):k(i,p);function b(){var T=w.get(arguments);if(T===e){if(T=g.apply(null,arguments),m){var v=w.getEntries(),A=v.find(function(z){return m(z.value,T)});A&&(T=A.value)}w.put(arguments,T)}return T}return b.clearCache=function(){return w.clear()},b}function le(g){var n=Array.isArray(g[0])?g[0]:g;if(!n.every(function(s){return typeof s=="function"})){var a=n.map(function(s){return typeof s=="function"?"function "+(s.name||"unnamed")+"()":typeof s}).join(", ");throw new Error("createSelector expects all input-selectors to be functions, but received the following types: ["+a+"]")}return n}function R(g){for(var n=arguments.length,a=new Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];var E=function(){for(var i=arguments.length,m=new Array(i),p=0;p<i;p++)m[p]=arguments[p];var w=0,b,T={memoizeOptions:void 0},v=m.pop();if(typeof v=="object"&&(T=v,v=m.pop()),typeof v!="function")throw new Error("createSelector expects an output function after the inputs, but received: ["+typeof v+"]");var A=T,z=A.memoizeOptions,H=z===void 0?a:z,S=Array.isArray(H)?H:[H],O=le(m),ae=g.apply(void 0,[function(){return w++,v.apply(null,arguments)}].concat(S)),X=g(function(){for(var ne=[],Q=O.length,Y=0;Y<Q;Y++)ne.push(O[Y].apply(null,arguments));return b=ae.apply(null,ne),b});return Object.assign(X,{resultFunc:v,memoizedResultFunc:ae,dependencies:O,lastResult:function(){return b},recomputations:function(){return w},resetRecomputations:function(){return w=0}}),X};return E}var re=R(se),F=function(n,a){if(a===void 0&&(a=re),typeof n!="object")throw new Error("createStructuredSelector expects first argument to be an object "+("where each property is a selector, instead received a "+typeof n));var s=Object.keys(n),E=a(s.map(function(h){return n[h]}),function(){for(var h=arguments.length,i=new Array(h),m=0;m<h;m++)i[m]=arguments[m];return i.reduce(function(p,w,b){return p[s[b]]=w,p},{})});return E}}}]);
