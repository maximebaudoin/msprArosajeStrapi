(self.webpackChunkmspr_arosaje_strapi=self.webpackChunkmspr_arosaje_strapi||[]).push([[2282],{8971:(y,L,e)=>{"use strict";e.r(L),e.d(L,{ProvidersPage:()=>de,default:()=>Ue});var t=e(53547),c=e(14087),o=e(17034),s=e(185),l=e(53979),u=e(49066),r=e(38939),m=e(8060),g=e(79031),f=e(37909),v=e(84170),p=e(63237),z=e(15234),S=e(12028),n=e(42609),B=e(4585),j=e(18721),te=e.n(j),$=e(11700),X=e.n($),Q=e(86896),V=e(88767),me=e(42866),ge=e(24969),fe=e(59946),pe=e(11047),ve=e(11276),he=e(67819),be=e(36856),ae=e(29728),ye=e(63321),Ee=e(36773),Pe=e(41054),Me=e(45697),a=e.n(Me),Le=e(93127),Te=e(16364);const J=({description:d,disabled:E,intlLabel:T,error:O,name:M,onChange:R,placeholder:x,providerToEditName:A,type:F,value:h})=>{const{formatMessage:C}=(0,Q.Z)(),U=M==="noName"?`${window.strapi.backendURL}/api/connect/${A}/callback`:h,N=C({id:T.id,defaultMessage:T.defaultMessage},{provider:A,...T.values}),Z=d?C({id:d.id,defaultMessage:d.defaultMessage},{provider:A,...d.values}):"";if(F==="bool")return t.createElement(Le.s,{"aria-label":M,checked:h,disabled:E,hint:Z,label:N,name:M,offLabel:C({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:C({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:G=>{R({target:{name:M,value:G.target.checked}})}});const w=x?C({id:x.id,defaultMessage:x.defaultMessage},{...x.values}):"",q=O?C({id:O,defaultMessage:O}):"";return t.createElement(Te.o,{"aria-label":M,disabled:E,error:q,label:N,name:M,onChange:R,placeholder:w,type:F,value:U})};J.defaultProps={description:null,disabled:!1,error:"",placeholder:null,value:""},J.propTypes={description:a().shape({id:a().string.isRequired,defaultMessage:a().string.isRequired,values:a().object}),disabled:a().bool,error:a().string,intlLabel:a().shape({id:a().string.isRequired,defaultMessage:a().string.isRequired,values:a().object}).isRequired,name:a().string.isRequired,onChange:a().func.isRequired,placeholder:a().shape({id:a().string.isRequired,defaultMessage:a().string.isRequired,values:a().object}),providerToEditName:a().string.isRequired,type:a().string.isRequired,value:a().oneOfType([a().bool,a().string])};const Be=J,K=({headerBreadcrumbs:d,initialData:E,isSubmiting:T,layout:O,isOpen:M,onSubmit:R,onToggle:x,providerToEditName:A})=>{const{formatMessage:F}=(0,Q.Z)();return M?t.createElement(me.P,{onClose:x,labelledBy:"title"},t.createElement(ge.x,null,t.createElement(ye.O,{label:d.join(", ")},d.map((h,C,U)=>t.createElement(Ee.$,{isCurrent:C===U.length-1,key:h},h)))),t.createElement(Pe.J9,{onSubmit:h=>R(h),initialValues:E,validationSchema:O.schema,validateOnChange:!1},({errors:h,handleChange:C,values:U})=>t.createElement(n.Form,null,t.createElement(fe.f,null,t.createElement(pe.k,{direction:"column",alignItems:"stretch",gap:1},t.createElement(ve.r,{gap:5},O.form.map(N=>N.map(Z=>t.createElement(he.P,{key:Z.name,col:Z.size,xs:12},t.createElement(Be,{...Z,error:h[Z.name],onChange:C,value:U[Z.name],providerToEditName:A}))))))),t.createElement(be.m,{startActions:t.createElement(ae.z,{variant:"tertiary",onClick:x,type:"button"},F({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:t.createElement(ae.z,{type:"submit",loading:T},F({id:"global.save",defaultMessage:"Save"}))})))):null};K.defaultProps={initialData:null,providerToEditName:null},K.propTypes={headerBreadcrumbs:a().arrayOf(a().string).isRequired,initialData:a().object,layout:a().shape({form:a().arrayOf(a().array),schema:a().object}).isRequired,isOpen:a().bool.isRequired,isSubmiting:a().bool.isRequired,onSubmit:a().func.isRequired,onToggle:a().func.isRequired,providerToEditName:a().string};const xe=K;var re=e(81912),b=e(89031);const Ce=async d=>{try{const{get:E}=(0,n.getFetchClient)(),{data:T}=await E((0,b.Gc)("providers"));return T}catch{throw d({type:"warning",message:{id:"notification.error"}}),new Error("error")}},Oe=d=>{const{put:E}=(0,n.getFetchClient)();return E((0,b.Gc)("providers"),d)};var Ze=e(89734),Re=e.n(Ze);const Fe=d=>Re()(Object.keys(d).reduce((E,T)=>{const{icon:O,enabled:M,subdomain:R}=d[T],x=O==="envelope"?["fas","envelope"]:["fab",O];return R!==void 0?E.push({name:T,icon:x,enabled:M,subdomain:R}):E.push({name:T,icon:x,enabled:M}),E},[]),"name");var i=e(87561);const ne={id:(0,b.OB)("PopUpForm.Providers.redirectURL.front-end.label"),defaultMessage:"The redirect URL to your front-end app"},se={id:"http://www.client-app.com",defaultMessage:"http://www.client-app.com"},Y={id:(0,b.OB)("PopUpForm.Providers.enabled.description"),defaultMessage:"If disabled, users won't be able to use this provider."},k={id:(0,b.OB)("PopUpForm.Providers.enabled.label"),defaultMessage:"Enable"},ie={id:(0,b.OB)("PopUpForm.Providers.key.label"),defaultMessage:"Client ID"},oe={id:(0,b.OB)("PopUpForm.Providers.redirectURL.label"),defaultMessage:"The redirect URL to add in your {provider} application configurations"},D={id:(0,b.OB)("PopUpForm.Providers.key.placeholder"),defaultMessage:"TEXT"},le={id:(0,b.OB)("PopUpForm.Providers.secret.label"),defaultMessage:"Client Secret"},I={email:{form:[[{intlLabel:k,name:"enabled",type:"bool",description:Y,size:6}]],schema:i.Ry().shape({enabled:i.Xg().required(n.translatedErrors.required)})},providers:{form:[[{intlLabel:k,name:"enabled",type:"bool",description:Y,size:6,validations:{required:!0}}],[{intlLabel:ie,name:"key",type:"text",placeholder:D,size:12,validations:{required:!0}}],[{intlLabel:le,name:"secret",type:"text",placeholder:D,size:12,validations:{required:!0}}],[{intlLabel:ne,placeholder:se,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:oe,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:i.Ry().shape({enabled:i.Xg().required(n.translatedErrors.required),key:i.Z_().when("enabled",{is:!0,then:i.Z_().required(n.translatedErrors.required),otherwise:i.Z_()}),secret:i.Z_().when("enabled",{is:!0,then:i.Z_().required(n.translatedErrors.required),otherwise:i.Z_()}),callback:i.Z_().when("enabled",{is:!0,then:i.Z_().required(n.translatedErrors.required),otherwise:i.Z_()})})},providersWithSubdomain:{form:[[{intlLabel:k,name:"enabled",type:"bool",description:Y,size:6,validations:{required:!0}}],[{intlLabel:ie,name:"key",type:"text",placeholder:D,size:12,validations:{required:!0}}],[{intlLabel:le,name:"secret",type:"text",placeholder:D,size:12,validations:{required:!0}}],[{intlLabel:{id:(0,b.OB)({id:"PopUpForm.Providers.jwksurl.label"}),defaultMessage:"JWKS URL"},name:"jwksurl",type:"text",placeholder:D,size:12,validations:{required:!1}}],[{intlLabel:{id:(0,b.OB)("PopUpForm.Providers.subdomain.label"),defaultMessage:"Host URI (Subdomain)"},name:"subdomain",type:"text",placeholder:{id:(0,b.OB)("PopUpForm.Providers.subdomain.placeholder"),defaultMessage:"my.subdomain.com"},size:12,validations:{required:!0}}],[{intlLabel:ne,placeholder:se,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:oe,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:i.Ry().shape({enabled:i.Xg().required(n.translatedErrors.required),key:i.Z_().when("enabled",{is:!0,then:i.Z_().required(n.translatedErrors.required),otherwise:i.Z_()}),secret:i.Z_().when("enabled",{is:!0,then:i.Z_().required(n.translatedErrors.required),otherwise:i.Z_()}),subdomain:i.Z_().when("enabled",{is:!0,then:i.Z_().required(n.translatedErrors.required),otherwise:i.Z_()}),callback:i.Z_().when("enabled",{is:!0,then:i.Z_().required(n.translatedErrors.required),otherwise:i.Z_()})})}},de=()=>{const{formatMessage:d}=(0,Q.Z)();(0,n.useFocusWhenNavigate)();const{notifyStatus:E}=(0,c.G)(),T=(0,V.useQueryClient)(),{trackUsage:O}=(0,n.useTracking)(),M=(0,t.useRef)(O),[R,x]=(0,t.useState)(!1),[A,F]=(0,t.useState)(!1),[h,C]=(0,t.useState)(null),U=(0,n.useNotification)(),{lockApp:N,unlockApp:Z}=(0,n.useOverlayBlocker)(),w=(0,t.useMemo)(()=>({update:re.Z.updateProviders}),[]),{isLoading:q,allowedActions:{canUpdate:G}}=(0,n.useRBAC)(w),{isLoading:Se,data:H,isFetching:Ae}=(0,V.useQuery)("get-providers",()=>Ce(U),{onSuccess(){E(d({id:(0,b.OB)("Providers.data.loaded"),defaultMessage:"Providers have been loaded"}))},initialData:{}}),ze=Se||Ae,je=(0,V.useMutation)(Oe,{async onSuccess(){await T.invalidateQueries("get-providers"),U({type:"info",message:{id:(0,b.OB)("notification.success.submit")}}),M.current("didEditAuthenticationProvider"),F(!1),_(),Z()},onError(){U({type:"warning",message:{id:"notification.error"}}),Z(),F(!1)},refetchActive:!1}),W=(0,t.useMemo)(()=>Fe(H),[H]),Ne=W.length,ue=(0,t.useMemo)(()=>{if(!h)return!1;const P=W.find(ee=>ee.name===h);return te()(P,"subdomain")},[W,h]),De=d({id:(0,b.OB)("HeaderNav.link.providers"),defaultMessage:"Providers"}),Ge=(0,t.useMemo)(()=>h==="email"?I.email:ue?I.providersWithSubdomain:I.providers,[h,ue]),_=()=>{x(P=>!P)},ce=P=>{G&&(C(P.name),_())},He=async P=>{F(!0),N(),M.current("willEditAuthenticationProvider");const ee={...H,[h]:P};je.mutate({providers:ee})};return t.createElement(o.A,null,t.createElement(n.SettingsPageTitle,{name:De}),t.createElement(s.o,null,t.createElement(l.T,{title:d({id:(0,b.OB)("HeaderNav.link.providers"),defaultMessage:"Providers"})}),ze||q?t.createElement(n.LoadingIndicatorPage,null):t.createElement(u.D,null,t.createElement(r.i,{colCount:3,rowCount:Ne+1},t.createElement(m.h,null,t.createElement(g.Tr,null,t.createElement(f.Th,null,t.createElement(v.Z,{variant:"sigma",textColor:"neutral600"},d({id:"global.name",defaultMessage:"Name"}))),t.createElement(f.Th,null,t.createElement(v.Z,{variant:"sigma",textColor:"neutral600"},d({id:(0,b.OB)("Providers.status"),defaultMessage:"Status"}))),t.createElement(f.Th,null,t.createElement(v.Z,{variant:"sigma"},t.createElement(p.T,null,d({id:"global.settings",defaultMessage:"Settings"})))))),t.createElement(z.p,null,W.map(P=>t.createElement(g.Tr,{key:P.name,...(0,n.onRowClick)({fn:()=>ce(P),condition:G})},t.createElement(f.Td,{width:"45%"},t.createElement(v.Z,{fontWeight:"semiBold",textColor:"neutral800"},P.name)),t.createElement(f.Td,{width:"65%"},t.createElement(v.Z,{textColor:P.enabled?"success600":"danger600","data-testid":`enable-${P.name}`},P.enabled?d({id:"global.enabled",defaultMessage:"Enabled"}):d({id:"global.disabled",defaultMessage:"Disabled"}))),t.createElement(f.Td,{...n.stopPropagation},G&&t.createElement(S.h,{onClick:()=>ce(P),noBorder:!0,icon:t.createElement(B.Z,null),label:"Edit"})))))))),t.createElement(xe,{initialData:H[h],isOpen:R,isSubmiting:A,layout:Ge,headerBreadcrumbs:[d({id:(0,b.OB)("PopUpForm.header.edit.providers"),defaultMessage:"Edit Provider"}),X()(h)],onToggle:_,onSubmit:He,providerToEditName:h}))},Ue=()=>t.createElement(n.CheckPagePermissions,{permissions:re.Z.readProviders},t.createElement(de,null))},89031:(y,L,e)=>{"use strict";e.d(L,{YX:()=>s,Gc:()=>r,OB:()=>m.Z});var t=e(41609),c=e.n(t);const s=g=>Object.keys(g).reduce((f,v)=>{const p=g[v].controllers,z=Object.keys(p).reduce((S,n)=>(c()(p[n])||(S[n]=p[n]),S),{});return c()(z)||(f[v]={controllers:z}),f},{});var l=e(31498);const r=g=>`/${l.Z}/${g}`;var m=e(84757)},89881:(y,L,e)=>{var t=e(47816),c=e(99291),o=c(t);y.exports=o},69199:(y,L,e)=>{var t=e(89881),c=e(98612);function o(s,l){var u=-1,r=c(s)?Array(s.length):[];return t(s,function(m,g,f){r[++u]=l(m,g,f)}),r}y.exports=o},82689:(y,L,e)=>{var t=e(29932),c=e(97786),o=e(67206),s=e(69199),l=e(71131),u=e(7518),r=e(85022),m=e(6557),g=e(1469);function f(v,p,z){p.length?p=t(p,function(B){return g(B)?function(j){return c(j,B.length===1?B[0]:B)}:B}):p=[m];var S=-1;p=t(p,u(o));var n=s(v,function(B,j,te){var $=t(p,function(X){return X(B)});return{criteria:$,index:++S,value:B}});return l(n,function(B,j){return r(B,j,z)})}y.exports=f},71131:y=>{function L(e,t){var c=e.length;for(e.sort(t);c--;)e[c]=e[c].value;return e}y.exports=L},26393:(y,L,e)=>{var t=e(33448);function c(o,s){if(o!==s){var l=o!==void 0,u=o===null,r=o===o,m=t(o),g=s!==void 0,f=s===null,v=s===s,p=t(s);if(!f&&!p&&!m&&o>s||m&&g&&v&&!f&&!p||u&&g&&v||!l&&v||!r)return 1;if(!u&&!m&&!p&&o<s||p&&l&&r&&!u&&!m||f&&l&&r||!g&&r||!v)return-1}return 0}y.exports=c},85022:(y,L,e)=>{var t=e(26393);function c(o,s,l){for(var u=-1,r=o.criteria,m=s.criteria,g=r.length,f=l.length;++u<g;){var v=t(r[u],m[u]);if(v){if(u>=f)return v;var p=l[u];return v*(p=="desc"?-1:1)}}return o.index-s.index}y.exports=c},99291:(y,L,e)=>{var t=e(98612);function c(o,s){return function(l,u){if(l==null)return l;if(!t(l))return o(l,u);for(var r=l.length,m=s?r:-1,g=Object(l);(s?m--:++m<r)&&u(g[m],m,g)!==!1;);return l}}y.exports=c},89734:(y,L,e)=>{var t=e(21078),c=e(82689),o=e(5976),s=e(16612),l=o(function(u,r){if(u==null)return[];var m=r.length;return m>1&&s(u,r[0],r[1])?r=[]:m>2&&s(r[0],r[1],r[2])&&(r=[r[0]]),c(u,t(r,1),[])});y.exports=l}}]);
