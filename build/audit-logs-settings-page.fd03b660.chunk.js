"use strict";(self.webpackChunkmspr_arosaje_strapi=self.webpackChunkmspr_arosaje_strapi||[]).push([[2812],{50935:(W,S,t)=>{t.d(S,{R:()=>D});var e=t(42609),l=t(80129),L=t(88767);function D(P={},v={}){const{id:c="",...R}=P,h=(0,l.stringify)(R,{encode:!1}),{get:f}=(0,e.useFetchClient)(),{data:p,isError:M,isLoading:O,refetch:U}=(0,L.useQuery)(["users",c,R],async()=>{const{data:{data:A}}=await f(`/admin/users/${c}${h?`?${h}`:""}`);return A},v);let T=[];return c&&p?T=[p]:Array.isArray(p?.results)&&(T=p.results),{users:T,pagination:p?.pagination??null,isLoading:O,isError:M,refetch:U}}},94699:(W,S,t)=>{t.d(S,{Z:()=>f});var e=t(53547),l=t(41580),L=t(29728),D=t(42609),P=t(89597),v=t(45697),c=t.n(v),R=t(86896);const h=({displayedFilters:p})=>{const[M,O]=(0,e.useState)(!1),{formatMessage:U}=(0,R.Z)(),T=(0,e.useRef)(),A=()=>{O(Z=>!Z)};return e.createElement(e.Fragment,null,e.createElement(l.x,{paddingTop:1,paddingBottom:1},e.createElement(L.z,{variant:"tertiary",ref:T,startIcon:e.createElement(P.Z,null),onClick:A,size:"S"},U({id:"app.utils.filters",defaultMessage:"Filters"})),M&&e.createElement(D.FilterPopoverURLQuery,{displayedFilters:p,isVisible:M,onToggle:A,source:T})),e.createElement(D.FilterListURLQuery,{filtersSchema:p}))};h.propTypes={displayedFilters:c().arrayOf(c().shape({name:c().string.isRequired,metadatas:c().shape({label:c().string}),fieldSchema:c().shape({type:c().string})})).isRequired};const f=h},35915:(W,S,t)=>{t.r(S),t.d(S,{default:()=>Le});var e=t(53547),l=t(42609),L=t(87751),D=t(17034),P=t(49066),v=t(41580),c=t(185),R=t(53979),h=t(36989),f=t(86896),p=t(94699),M=t(88767),O=t(16550),U=t(50935);const A=({canReadAuditLogs:a,canReadUsers:d})=>{const{get:u}=(0,l.useFetchClient)(),{search:i}=(0,O.TH)(),m=(0,l.useNotification)(),n={keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError:y=>m({type:"warning",message:y.message})},{users:r,isError:o,isLoading:g}=(0,U.R)({},{...n,enabled:d,staleTime:2*(1e3*60)}),{data:E,isLoading:C,isError:B}=(0,M.useQuery)(["auditLogs",i],async({queryKey:y})=>{const ve=y[1],{data:he}=await u(`/admin/audit-logs${ve}`);return he},{...n,enabled:a});return{auditLogs:E,users:r,isLoading:g||C,hasError:B||o}};var Z=t(42866),X=t(24969),w=t(59946),k=t(63321),q=t(36773),_=t(45697),s=t.n(_),ee=t(23855);const K=()=>{const{formatDate:a}=(0,f.Z)();return u=>{const i=(0,ee.Z)(u),m=a(i,{dateStyle:"long"}),n=a(i,{timeStyle:"medium",hourCycle:"h24"});return`${m}, ${n}`}};var b=t(11047),te=t(77197),F=t(84170),ae=t(11276),se=t(39990);const j={"entry.create":"Create entry{model, select, undefined {} other { ({model})}}","entry.update":"Update entry{model, select, undefined {} other { ({model})}}","entry.delete":"Delete entry{model, select, undefined {} other { ({model})}}","entry.publish":"Publish entry{model, select, undefined {} other { ({model})}}","entry.unpublish":"Unpublish entry{model, select, undefined {} other { ({model})}}","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},$=a=>j[a]||a,H=({actionLabel:a,actionName:d})=>e.createElement(b.k,{direction:"column",alignItems:"baseline",gap:1},e.createElement(F.Z,{textColor:"neutral600",variant:"sigma"},a),e.createElement(F.Z,{textColor:"neutral600"},d));H.propTypes={actionLabel:s().string.isRequired,actionName:s().string.isRequired};const I=H,N=({status:a,data:d,formattedDate:u})=>{const{formatMessage:i}=(0,f.Z)();if(a==="loading")return e.createElement(b.k,{padding:7,justifyContent:"center",alignItems:"center"},e.createElement(te.a,null,"Loading content..."));const{action:m,user:n,payload:r}=d;return e.createElement(e.Fragment,null,e.createElement(v.x,{marginBottom:3},e.createElement(F.Z,{variant:"delta",id:"title"},i({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"}))),e.createElement(ae.r,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0},e.createElement(I,{actionLabel:i({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:i({id:`Settings.permissions.auditLogs.${m}`,defaultMessage:$(m)},{model:r?.model})}),e.createElement(I,{actionLabel:i({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:u}),e.createElement(I,{actionLabel:i({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:n?.displayName||"-"}),e.createElement(I,{actionLabel:i({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:n?.id.toString()||"-"})),e.createElement(se.V,{value:JSON.stringify(r,null,2),disabled:!0,label:i({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})}))};N.defaultProps={data:{}},N.propTypes={status:s().oneOf(["idle","loading","error","success"]).isRequired,data:s().shape({action:s().string,date:s().string,payload:s().object,user:s().object}),formattedDate:s().string.isRequired};const ne=N,z=({handleClose:a,logId:d})=>{const{get:u}=(0,l.useFetchClient)(),i=(0,l.useNotification)(),m=async E=>{const{data:C}=await u(`/admin/audit-logs/${E}`);if(!C)throw new Error("Audit log not found");return C},{data:n,status:r}=(0,M.useQuery)(["audit-log",d],()=>m(d),{onError(){i({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),a()}}),o=K(),g=n?o(n.date):"";return e.createElement(Z.P,{onClose:a,labelledBy:"title"},e.createElement(X.x,null,e.createElement(k.O,{label:g,id:"title"},e.createElement(q.$,{isCurrent:!0},g))),e.createElement(w.f,null,e.createElement(ne,{status:r,data:n,formattedDate:g})))};z.propTypes={handleClose:s().func.isRequired,logId:s().string.isRequired};const oe=z,x=({pagination:a})=>e.createElement(v.x,{paddingTop:4},e.createElement(b.k,{alignItems:"flex-end",justifyContent:"space-between"},e.createElement(l.PageSizeURLQuery,null),e.createElement(l.PaginationURLQuery,{pagination:a})));x.defaultProps={pagination:{pageCount:0,pageSize:50,total:0}},x.propTypes={pagination:s().shape({page:s().number,pageCount:s().number,pageSize:s().number,total:s().number})};const ie=x;var re=t(15234),le=t(79031),J=t(37909),de=t(12028),me=t(8934);const V=({headers:a,rows:d,onOpenModal:u})=>{const{formatMessage:i}=(0,f.Z)(),m=K(),n=({type:r,value:o,model:g})=>r==="date"?m(o):r==="action"?i({id:`Settings.permissions.auditLogs.${o}`,defaultMessage:$(o)},{model:g}):o||"-";return e.createElement(re.p,null,d.map(r=>e.createElement(le.Tr,{key:r.id,...(0,l.onRowClick)({fn:()=>u(r.id)})},a.map(({key:o,name:g,cellFormatter:E})=>e.createElement(J.Td,{key:o},e.createElement(F.Z,{textColor:"neutral800"},n({type:o,value:E?E(r[g]):r[g],model:r.payload?.model})))),e.createElement(J.Td,{...l.stopPropagation},e.createElement(b.k,{justifyContent:"end"},e.createElement(de.h,{onClick:()=>u(r.id),"aria-label":i({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${r.action} action`}),noBorder:!0,icon:e.createElement(me.Z,null)}))))))};V.defaultProps={rows:[]},V.propTypes={headers:s().array.isRequired,rows:s().array,onOpenModal:s().func.isRequired};const ue=V;var ce=t(29178),ge=t(90608);const Q=({value:a,options:d,onChange:u})=>{const{formatMessage:i}=(0,f.Z)(),m=i({id:"Settings.permissions.auditLogs.filter.aria-label",defaultMessage:"Search and select an option to filter"});return e.createElement(ce.hQ,{"aria-label":m,value:a,onChange:u},d.map(({label:n,customValue:r})=>e.createElement(ge.O,{key:r,value:r},n)))};Q.defaultProps={value:null},Q.propTypes={value:s().string,options:s().arrayOf(s().shape({label:s().string.isRequired,customValue:s().string.isRequired}).isRequired).isRequired,onChange:s().func.isRequired};const Y=Q,G=[{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"},value:"$eq"},{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"},value:"$ne"}],pe=({formatMessage:a,users:d,canReadUsers:u})=>{const i=Object.keys(j).map(n=>({label:a({id:`Settings.permissions.auditLogs.${n}`,defaultMessage:$(n)},{model:void 0}),customValue:n})),m=[{name:"action",metadatas:{customOperators:G,label:a({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),options:i,customInput:Y},fieldSchema:{type:"enumeration"}},{name:"date",metadatas:{label:a({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"})},fieldSchema:{type:"datetime"}}];if(u&&d){const n=o=>o.username?o.username:o.firstname&&o.lastname?a({id:"Settings.permissions.auditLogs.user.fullname",defaultMessage:"{firstname} {lastname}"},{firstname:o.firstname,lastname:o.lastname}):o.email,r=d.map(o=>({label:n(o),customValue:o.id.toString()}));return[...m,{name:"user",metadatas:{customOperators:G,label:a({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),options:r,customInput:Y},fieldSchema:{type:"relation",mainField:{name:"id"}}}]}return m},fe=[{name:"action",key:"action",metadatas:{label:{id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"},sortable:!0}},{name:"date",key:"date",metadatas:{label:{id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"},sortable:!0}},{key:"user",name:"user",metadatas:{label:{id:"Settings.permissions.auditLogs.user",defaultMessage:"User"},sortable:!1},cellFormatter:a=>a?a.displayName:""}],ye={...L.Z.settings.auditLogs,readUsers:L.Z.settings.users.read},Ee=()=>{const{formatMessage:a}=(0,f.Z)(),{allowedActions:{canRead:d,canReadUsers:u}}=(0,l.useRBAC)(ye),[{query:i},m]=(0,l.useQueryParams)(),{auditLogs:n,users:r,isLoading:o,hasError:g}=A({canReadAuditLogs:d,canReadUsers:u});(0,l.useFocusWhenNavigate)();const E=pe({formatMessage:a,users:r,canReadUsers:u}),C=a({id:"global.auditLogs",defaultMessage:"Audit Logs"}),B=fe.map(y=>({...y,metadatas:{...y.metadatas,label:a(y.metadatas.label)}}));return g?e.createElement(D.A,null,e.createElement(P.D,null,e.createElement(v.x,{paddingTop:8},e.createElement(l.AnErrorOccurred,null)))):e.createElement(c.o,{"aria-busy":o},e.createElement(l.SettingsPageTitle,{name:C}),e.createElement(R.T,{title:C,subtitle:a({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),e.createElement(h.Z,{startActions:e.createElement(p.Z,{displayedFilters:E})}),e.createElement(P.D,{canRead:d},e.createElement(l.DynamicTable,{contentType:"Audit logs",headers:B,rows:n?.results||[],withBulkActions:!0,isLoading:o},e.createElement(ue,{headers:B,rows:n?.results||[],onOpenModal:y=>m({id:y})})),e.createElement(ie,{pagination:n?.pagination})),i?.id&&e.createElement(oe,{handleClose:()=>m({id:null},"remove"),logId:i.id}))},Le=()=>e.createElement(l.CheckPagePermissions,{permissions:L.Z.settings.auditLogs.main},e.createElement(Ee,null))}}]);
