"use strict";(self.webpackChunkmspr_arosaje_strapi=self.webpackChunkmspr_arosaje_strapi||[]).push([[3455],{98906:(Ee,A,t)=>{t.r(A),t.d(A,{default:()=>ue});var e=t(53547),a=t(42609),B=t(87751),S=t(185),U=t(53979),W=t(29728),j=t(36989),V=t(49066),k=t(38939),z=t(49386),H=t(8060),I=t(79031),p=t(37909),y=t(84170),Q=t(63237),$=t(15234),G=t(65186),J=t(4585),K=t(20022),b=t(96315),X=t(27361),Y=t.n(X),P=t(86896),w=t(16550),q=t(51319);const _=()=>"todo empty role";var ee=t(11047),te=t(41580),le=t(12028),ne=t(45697),D=t.n(ne);const Z=({id:s,name:o,description:l,usersCount:g,icons:r,rowIndex:u,canUpdate:E})=>{const{formatMessage:C}=(0,P.Z)(),[,i]=r,h=C({id:"Roles.RoleRow.user-count",defaultMessage:"{number, plural, =0 {#  user} one {#  user} other {# users}}"},{number:g});return e.createElement(I.Tr,{"aria-rowindex":u,key:s,...E?(0,a.onRowClick)({fn:i.onClick}):{}},e.createElement(p.Td,{maxWidth:(0,a.pxToRem)(130)},e.createElement(y.Z,{ellipsis:!0,textColor:"neutral800"},o)),e.createElement(p.Td,{maxWidth:(0,a.pxToRem)(250)},e.createElement(y.Z,{ellipsis:!0,textColor:"neutral800"},l)),e.createElement(p.Td,null,e.createElement(y.Z,{textColor:"neutral800"},h)),e.createElement(p.Td,null,e.createElement(ee.k,{justifyContent:"flex-end",...a.stopPropagation},r.map((c,R)=>c?e.createElement(te.x,{key:c.label,paddingLeft:R===0?0:1},e.createElement(le.h,{onClick:c.onClick,label:c.label,noBorder:!0,icon:c.icon})):null))))};Z.propTypes={id:D().number.isRequired,name:D().string.isRequired,description:D().string.isRequired,usersCount:D().number.isRequired,icons:D().array.isRequired,rowIndex:D().number.isRequired,canUpdate:D().bool},Z.defaultProps={canUpdate:!1};const se=Z;var ae=t(18172);const oe={roleToDelete:null,showModalConfirmButtonLoading:!1,shouldRefetchData:!1},re=(s,o)=>(0,ae.ZP)(s,l=>{switch(o.type){case"ON_REMOVE_ROLES":{l.showModalConfirmButtonLoading=!0;break}case"ON_REMOVE_ROLES_SUCCEEDED":{l.shouldRefetchData=!0,l.roleToDelete=null;break}case"RESET_DATA_TO_DELETE":{l.shouldRefetchData=!1,l.roleToDelete=null,l.showModalConfirmButtonLoading=!1;break}case"SET_ROLE_TO_DELETE":{l.roleToDelete=o.id;break}default:return l}}),ie=()=>{(0,a.useFocusWhenNavigate)();const{locale:s}=(0,P.Z)(),{isLoading:o,allowedActions:{canCreate:l,canDelete:g,canRead:r,canUpdate:u}}=(0,a.useRBAC)(B.Z.settings.roles),{getData:E,roles:C,isLoading:i}=(0,q.bF)(!1),[{query:h}]=(0,a.useQueryParams)(),c=h?._q||"",{includes:R}=(0,a.useFilter)(s,{sensitivity:"base"}),T=(0,a.useCollator)(s,{sensitivity:"base"}),L=(C||[]).filter(f=>R(f.name,c)||R(f.description,c)).sort((f,v)=>T.compare(f.name,v.name)||T.compare(f.description,v.description));return(0,e.useEffect)(()=>{!o&&r&&E()},[o,r,E]),{isLoadingForPermissions:o,canCreate:l,canDelete:g,canRead:r,canUpdate:u,isLoading:i,getData:E,sortedRoles:L,roles:C}},ce=({getData:s,canCreate:o,canDelete:l,canUpdate:g})=>{const{formatMessage:r}=(0,P.Z)(),u=(0,a.useNotification)(),[E,C]=(0,e.useState)(!1),{push:i}=(0,w.k6)(),[{selectedRoles:h,showModalConfirmButtonLoading:c,roleToDelete:R},T]=(0,e.useReducer)(re,oe),{post:L}=(0,a.getFetchClient)(),f=async()=>{try{T({type:"ON_REMOVE_ROLES"}),await L("/admin/roles/batch-delete",{ids:[R]}),await s(),T({type:"RESET_DATA_TO_DELETE"})}catch(n){const d=Y()(n,["response","payload","data","ids"],null);if(d&&Array.isArray(d)){const ge=d.join(`
`);u({type:"warning",message:ge})}else u({type:"warning",message:{id:"notification.error"}})}m()},v=(0,e.useCallback)(n=>{i(`/settings/roles/duplicate/${n}`)},[i]),x=()=>i("/settings/roles/new"),M=(0,e.useCallback)(n=>{T({type:"SET_ROLE_TO_DELETE",id:n}),m()},[]),m=()=>C(n=>!n),O=(0,e.useCallback)(n=>{i(`/settings/roles/${n}`)},[i]),N=(0,e.useCallback)((n,d)=>{n.preventDefault(),n.stopPropagation(),d.usersCount?u({type:"info",message:{id:"Roles.ListPage.notification.delete-not-allowed"}}):M(d.id)},[u,M]),F=(0,e.useCallback)((n,d)=>{n.preventDefault(),n.stopPropagation(),v(d.id)},[v]),me=(0,e.useCallback)(n=>[...o?[{onClick:d=>F(d,n),label:r({id:"app.utils.duplicate",defaultMessage:"Duplicate"}),icon:e.createElement(G.Z,null)}]:[],...g?[{onClick:()=>O(n.id),label:r({id:"app.utils.edit",defaultMessage:"Edit"}),icon:e.createElement(J.Z,null)}]:[],...l?[{onClick:d=>N(d,n),label:r({id:"global.delete",defaultMessage:"Delete"}),icon:e.createElement(K.Z,null)}]:[]],[r,N,F,O,o,g,l]);return{handleNewRoleClick:x,getIcons:me,selectedRoles:h,isWarningDeleteAllOpened:E,showModalConfirmButtonLoading:c,handleToggleModal:m,handleDeleteData:f}},de=()=>{const{formatMessage:s}=(0,P.Z)(),{isLoadingForPermissions:o,canCreate:l,canRead:g,canDelete:r,canUpdate:u,isLoading:E,getData:C,sortedRoles:i}=ie(),{handleNewRoleClick:h,getIcons:c,isWarningDeleteAllOpened:R,showModalConfirmButtonLoading:T,handleToggleModal:L,handleDeleteData:f}=ce({getData:C,canCreate:l,canDelete:r,canUpdate:u}),v=i.length+1,x=6;if(o)return e.createElement(S.o,null,e.createElement(a.LoadingIndicatorPage,null));const M=s({id:"global.roles",defaultMessage:"roles"});return e.createElement(S.o,null,e.createElement(a.SettingsPageTitle,{name:"Roles"}),e.createElement(U.T,{primaryAction:l?e.createElement(W.z,{onClick:h,startIcon:e.createElement(b.Z,null),size:"S"},s({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})):null,title:M,subtitle:s({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),as:"h2"}),g&&e.createElement(j.Z,{startActions:e.createElement(a.SearchURLQuery,{label:s({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:M})})}),g&&e.createElement(V.D,null,e.createElement(k.i,{colCount:x,rowCount:v,footer:l?e.createElement(z.c,{onClick:h,icon:e.createElement(b.Z,null)},s({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})):null},e.createElement(H.h,null,e.createElement(I.Tr,{"aria-rowindex":1},e.createElement(p.Th,null,e.createElement(y.Z,{variant:"sigma",textColor:"neutral600"},s({id:"global.name",defaultMessage:"Name"}))),e.createElement(p.Th,null,e.createElement(y.Z,{variant:"sigma",textColor:"neutral600"},s({id:"global.description",defaultMessage:"Description"}))),e.createElement(p.Th,null,e.createElement(y.Z,{variant:"sigma",textColor:"neutral600"},s({id:"global.users",defaultMessage:"Users"}))),e.createElement(p.Th,null,e.createElement(Q.T,null,s({id:"global.actions",defaultMessage:"Actions"}))))),e.createElement($.p,null,i?.map((m,O)=>e.createElement(se,{key:m.id,id:m.id,name:m.name,description:m.description,usersCount:m.usersCount,icons:c(m),rowIndex:O+2,canUpdate:u})))),!v&&!E&&e.createElement(_,null)),e.createElement(a.ConfirmDialog,{isOpen:R,onConfirm:f,isConfirmButtonLoading:T,onToggleDialog:L}))},ue=()=>e.createElement(a.CheckPagePermissions,{permissions:B.Z.settings.roles.main},e.createElement(de,null))}}]);
