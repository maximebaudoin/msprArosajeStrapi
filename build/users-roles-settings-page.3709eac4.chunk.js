(self.webpackChunkmspr_arosaje_strapi=self.webpackChunkmspr_arosaje_strapi||[]).push([[8853],{7842:(E,A,t)=>{"use strict";t.r(A),t.d(A,{default:()=>Dt});var e=t(53547),s=t(42609),o=t(16550),l=t(81912),i=t(31498),C=t(185),f=t(53979),T=t(29728),b=t(49066),v=t(11047),P=t(41580),g=t(84170),B=t(11276),M=t(67819),U=t(16364),Z=t(61467),k=t(85018),Q=t(41054),x=t(86896),G=t(45697),S=t.n(G);const ne=(0,e.createContext)({}),se=({children:n,value:r})=>e.createElement(ne.Provider,{value:r},n),K=()=>(0,e.useContext)(ne);se.propTypes={children:S().node.isRequired,value:S().object.isRequired};var H=t(84757),Pe=t(48734),Ae=t(74756),Te=t(63081),be=t(11700),De=t.n(be);function Le(n){switch(n){case"application":return"Application";case"plugin::content-manager":return"Content manager";case"plugin::content-type-builder":return"Content types builder";case"plugin::documentation":return"Documentation";case"plugin::email":return"Email";case"plugin::i18n":return"i18n";case"plugin::upload":return"Upload";case"plugin::users-permissions":return"Users-permissions";default:return De()(n.replace("api::","").replace("plugin::",""))}}const xe=Le,Se=(n,r)=>{const a=Object.keys(r).sort().map(c=>({name:c,isOpen:!1}));return{...n,collapses:a}};var Me=t(89734),ae=t.n(Me),re=t(36213),oe=t(63237),Ze=t(78114),Oe=t(27361),z=t.n(Oe),X=t(88972);const ie=(0,X.iv)`
  background: ${n=>n.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,Be=(0,X.ZP)(P.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${n=>n.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${n=>n.isActive&&ie}
  &:hover {
    ${ie}
  }
`,Ue=X.ZP.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:n})=>n.colors.neutral150};
`,le=({subCategory:n})=>{const{formatMessage:r}=(0,x.Z)(),{onChange:a,onChangeSelectAll:c,onSelectedAction:m,selectedAction:d,modifiedData:h}=K(),y=(0,e.useMemo)(()=>z()(h,n.name,{}),[h,n]),R=(0,e.useMemo)(()=>Object.values(y).every(u=>u.enabled===!0),[y]),p=(0,e.useMemo)(()=>Object.values(y).some(u=>u.enabled===!0)&&!R,[y,R]),L=(0,e.useCallback)(({target:{name:u}})=>{c({target:{name:u,value:!R}})},[R,c]),D=(0,e.useCallback)(u=>d===u,[d]);return e.createElement(P.x,null,e.createElement(v.k,{justifyContent:"space-between",alignItems:"center"},e.createElement(P.x,{paddingRight:4},e.createElement(g.Z,{variant:"sigma",textColor:"neutral600"},n.label)),e.createElement(Ue,null),e.createElement(P.x,{paddingLeft:4},e.createElement(re.X,{name:n.name,value:R,onValueChange:u=>L({target:{name:n.name,value:u}}),indeterminate:p},r({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(v.k,{paddingTop:6,paddingBottom:6},e.createElement(B.r,{gap:2,style:{flex:1}},n.actions.map(u=>{const N=`${u.name}.enabled`;return e.createElement(M.P,{col:6,key:u.name},e.createElement(Be,{isActive:D(u.name),padding:2,hasRadius:!0},e.createElement(re.X,{value:z()(h,N,!1),name:N,onValueChange:$=>a({target:{name:N,value:$}})},u.label),e.createElement("button",{type:"button",onClick:()=>m(u.name),style:{display:"inline-flex",alignItems:"center"}},e.createElement(oe.T,{as:"span"},r({id:"app.utils.show-bound-route",defaultMessage:"Show bound route for {route}"},{route:u.name})),e.createElement(Ze.Z,null))))}))))};le.propTypes={subCategory:S().object.isRequired};const ke=le,ce=({name:n,permissions:r})=>{const a=(0,e.useMemo)(()=>ae()(Object.values(r.controllers).reduce((c,m,d)=>{const h=`${n}.controllers.${Object.keys(r.controllers)[d]}`,y=ae()(Object.keys(m).reduce((R,p)=>[...R,{...m[p],label:p,name:`${h}.${p}`}],[]),"label");return[...c,{actions:y,label:Object.keys(r.controllers)[d],name:h}]},[]),"label"),[n,r]);return e.createElement(P.x,{padding:6},a.map(c=>e.createElement(ke,{key:c.name,subCategory:c})))};ce.propTypes={name:S().string.isRequired,permissions:S().object.isRequired};const Ne=ce;var q=t(18172);const Fe={collapses:[]},Ie=(n,r)=>(0,q.ZP)(n,a=>{switch(r.type){case"TOGGLE_COLLAPSE":{a.collapses=n.collapses.map((c,m)=>m===r.index?{...c,isOpen:!c.isOpen}:{...c,isOpen:!1});break}default:return a}}),$e=()=>{const{modifiedData:n}=K(),{formatMessage:r}=(0,x.Z)(),[{collapses:a},c]=(0,e.useReducer)(Ie,Fe,d=>Se(d,n)),m=d=>c({type:"TOGGLE_COLLAPSE",index:d});return e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:1},a.map((d,h)=>e.createElement(Pe.U,{expanded:d.isOpen,onToggle:()=>m(h),key:d.name,variant:h%2===0?"secondary":void 0},e.createElement(Ae.B,{title:xe(d.name),description:r({id:"users-permissions.Plugin.permissions.plugins.description",defaultMessage:"Define all allowed actions for the {name} plugin."},{name:d.name}),variant:h%2?"primary":"secondary"}),e.createElement(Te.v,null,e.createElement(P.x,null,e.createElement(Ne,{permissions:n[d.name],name:d.name}))))))};var Ge=t(41609),je=t.n(Ge),We=t(82569),Ve=t.n(We),He=t(70174),we=t.n(He),Qe=t(13217),ze=t.n(Qe);const Xe=n=>{switch(n){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Ye=(0,X.ZP)(P.x)`
  margin: -1px;
  border-radius: ${({theme:n})=>n.spaces[1]} 0 0 ${({theme:n})=>n.spaces[1]};
`;function _({route:n}){const{formatMessage:r}=(0,x.Z)(),{method:a,handler:c,path:m}=n,d=m?ze()(m.split("/")):[],[h="",y=""]=c?c.split("."):[],R=Xe(n.method);return e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(g.Z,{variant:"delta",as:"h3"},r({id:"users-permissions.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",e.createElement("span",null,h),e.createElement(g.Z,{variant:"delta",textColor:"primary600"},".",y)),e.createElement(v.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0},e.createElement(Ye,{background:R.background,borderColor:R.border,padding:2},e.createElement(g.Z,{fontWeight:"bold",textColor:R.text},a)),e.createElement(P.x,{paddingLeft:2,paddingRight:2},we()(d,p=>e.createElement(g.Z,{key:p,textColor:p.includes(":")?"neutral600":"neutral900"},"/",p)))))}_.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},_.propTypes={route:S().shape({handler:S().string,method:S().string,path:S().string})};const Je=_,Ke=()=>{const{formatMessage:n}=(0,x.Z)(),{selectedAction:r,routes:a}=K(),c=Ve()(r.split("."),"controllers"),m=z()(a,c[0]),d=c.slice(1).join("."),h=je()(m)?[]:m.filter(y=>y.handler.endsWith(d));return e.createElement(M.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},r?e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:2},h.map((y,R)=>e.createElement(Je,{key:R,route:y}))):e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(g.Z,{variant:"delta",as:"h3"},n({id:"users-permissions.Policies.header.title",defaultMessage:"Advanced settings"})),e.createElement(g.Z,{as:"p",textColor:"neutral600"},n({id:"users-permissions.Policies.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))},qe=(n,r,a)=>({...n,initialData:r,modifiedData:r,routes:a});var _e=t(36968),de=t.n(_e),et=t(69572),tt=t.n(et);const nt={initialData:{},modifiedData:{},routes:{},selectedAction:"",policies:[]},st=(n,r)=>(0,q.ZP)(n,a=>{switch(r.type){case"ON_CHANGE":{const c=r.keys.length,m=r.keys[c-1]==="enabled";if(r.value&&m){const d=tt()(r.keys,c-1).join(".");a.selectedAction=d}de()(a,["modifiedData",...r.keys],r.value);break}case"ON_CHANGE_SELECT_ALL":{const c=["modifiedData",...r.keys],m=z()(n,c,{}),d=Object.keys(m).reduce((h,y)=>(h[y]={...m[y],enabled:r.value},h),{});de()(a,c,d);break}case"ON_RESET":{a.modifiedData=n.initialData;break}case"ON_SUBMIT_SUCCEEDED":{a.initialData=n.modifiedData;break}case"SELECT_ACTION":{const{actionToSelect:c}=r;a.selectedAction=c===n.selectedAction?"":c;break}default:return a}}),ue=(0,e.forwardRef)(({permissions:n,routes:r},a)=>{const{formatMessage:c}=(0,x.Z)(),[m,d]=(0,e.useReducer)(st,nt,L=>qe(L,n,r));(0,e.useImperativeHandle)(a,()=>({getPermissions(){return{permissions:m.modifiedData}},resetForm(){d({type:"ON_RESET"})},setFormAfterSubmit(){d({type:"ON_SUBMIT_SUCCEEDED"})}}));const p={...m,onChange:({target:{name:L,value:D}})=>d({type:"ON_CHANGE",keys:L.split("."),value:D==="empty__string_value"?"":D}),onChangeSelectAll:({target:{name:L,value:D}})=>d({type:"ON_CHANGE_SELECT_ALL",keys:L.split("."),value:D}),onSelectedAction:L=>d({type:"SELECT_ACTION",actionToSelect:L})};return e.createElement(se,{value:p},e.createElement(B.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},e.createElement(M.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(g.Z,{variant:"delta",as:"h2"},c({id:(0,H.Z)("Plugins.header.title"),defaultMessage:"Permissions"})),e.createElement(g.Z,{as:"p",textColor:"neutral600"},c({id:(0,H.Z)("Plugins.header.description"),defaultMessage:"Only actions bound by a route are listed below."}))),e.createElement($e,null))),e.createElement(Ke,null)))});ue.propTypes={permissions:S().object.isRequired,routes:S().object.isRequired};const me=(0,e.memo)(ue);var W=t(89031);const wt={isLoading:!0,modifiedData:{}},Qt=(n,r)=>produce(n,a=>{switch(r.type){case"GET_DATA":{a.isLoading=!0,a.modifiedData={};break}case"GET_DATA_SUCCEEDED":{a.isLoading=!1,a.modifiedData=r.data;break}case"GET_DATA_ERROR":{a.isLoading=!0;break}case"ON_SUBMIT_SUCCEEDED":{a.modifiedData=r.data;break}default:return a}}),zt=null,Xt=(n,r)=>{const{isLoading:a,allowedActions:c}=useRBAC(r),[{isLoading:m,modifiedData:d},h]=useReducer(reducer,initialState),y=useNotification(),R=useRef(!0),{get:p}=useFetchClient();useEffect(()=>(a||(async()=>{try{h({type:"GET_DATA"});const{data:u}=await p(getRequestURL(n));h({type:"GET_DATA_SUCCEEDED",data:u})}catch(u){R.current&&(h({type:"GET_DATA_ERROR"}),console.error(u),y({type:"warning",message:{id:"notification.error"}}))}})(),()=>{R.current=!1}),[a,n,p,y]);const L=useCallback(D=>{h({type:"ON_SUBMIT_SUCCEEDED",data:D})},[]);return{allowedActions:c,dispatchSubmitSucceeded:L,isLoading:m,isLoadingForPermissions:a,modifiedData:d}},Yt=null,Jt={roles:[],isLoading:!0},Kt=(n,r)=>produce(n,a=>{switch(r.type){case"GET_DATA":{a.isLoading=!0,a.roles=[];break}case"GET_DATA_SUCCEEDED":{a.roles=r.data,a.isLoading=!1;break}case"GET_DATA_ERROR":{a.isLoading=!1;break}default:return a}}),qt=null,_t=(n=!0)=>{const[{roles:r,isLoading:a},c]=useReducer(reducer,initialState,()=>init(initialState,n)),m=useNotification(),d=useRef(!0),h=useFetchClient(),y=useCallback(async()=>{try{c({type:"GET_DATA"});const{data:{roles:R}}=await h.get(`/${pluginId}/roles`);c({type:"GET_DATA_SUCCEEDED",data:R})}catch(R){const p=get(R,["response","payload","message"],"An error occured");d.current&&(c({type:"GET_DATA_ERROR"}),p!=="Forbidden"&&m({type:"warning",message:p}))}},[h,m]);return useEffect(()=>(n&&y(),()=>{d.current=!1}),[n,y]),{roles:r,isLoading:a,getData:y}},en=null;var Y=t(88767);const ge=()=>{const n=(0,s.useNotification)(),{get:r}=(0,s.useFetchClient)(),{formatAPIError:a}=(0,s.useAPIErrorHandler)(W.OB),[{data:c,isLoading:m,error:d,refetch:h},{data:y,isLoading:R,error:p,refetch:L}]=(0,Y.useQueries)([{queryKey:[i.Z,"permissions"],async queryFn(){return(await r(`/${i.Z}/permissions`)).data.permissions}},{queryKey:[i.Z,"routes"],async queryFn(){return(await r(`/${i.Z}/routes`)).data.routes}}]),D=async()=>{await Promise.all([h(),L()])};(0,e.useEffect)(()=>{d&&n({type:"warning",message:a(d)})},[n,d,a]),(0,e.useEffect)(()=>{p&&n({type:"warning",message:a(p)})},[n,p,a]);const u=m||R;return{permissions:c?(0,W.YX)(c):{},routes:y??{},getData:D,isLoading:u}},at={role:{},isLoading:!0},rt=(n,r)=>(0,q.ZP)(n,a=>{switch(r.type){case"GET_DATA_SUCCEEDED":{a.role=r.role,a.isLoading=!1;break}case"GET_DATA_ERROR":{a.isLoading=!1;break}case"ON_SUBMIT_SUCCEEDED":{a.role.name=r.name,a.role.description=r.description;break}default:return a}}),ot=n=>{const[r,a]=(0,e.useReducer)(rt,at),c=(0,s.useNotification)(),m=(0,e.useRef)(null),{get:d}=(0,s.useFetchClient)();(0,e.useEffect)(()=>(m.current=!0,n?h(n):a({type:"GET_DATA_SUCCEEDED",role:{}}),()=>m.current=!1),[n]);const h=async R=>{try{const{data:{role:p}}=await d(`/${i.Z}/roles/${R}`);m.current&&a({type:"GET_DATA_SUCCEEDED",role:p})}catch(p){console.error(p),a({type:"GET_DATA_ERROR"}),c({type:"warning",message:{id:"notification.error"}})}},y=(0,e.useCallback)(R=>{a({type:"ON_SUBMIT_SUCCEEDED",...R})},[]);return{...r,onSubmitSucceeded:y}};var ee=t(87561);const pe=ee.Ry().shape({name:ee.Z_().required(s.translatedErrors.required),description:ee.Z_().required(s.translatedErrors.required)}),it=()=>{const{formatMessage:n}=(0,x.Z)(),[r,a]=(0,e.useState)(!1),c=(0,s.useNotification)(),{goBack:m}=(0,o.k6)(),{lockApp:d,unlockApp:h}=(0,s.useOverlayBlocker)(),{isLoading:y,permissions:R,routes:p}=ge(),{trackUsage:L}=(0,s.useTracking)(),D=(0,e.useRef)(),{post:u}=(0,s.useFetchClient)(),N=async $=>{d(),a(!0);try{const O=D.current.getPermissions();await u(`/${i.Z}/roles`,{...$,...O,users:[]}),L("didCreateRole"),c({type:"success",message:{id:(0,H.Z)("Settings.roles.created"),defaultMessage:"Role created"}}),m()}catch(O){console.error(O),c({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}a(!1),h()};return e.createElement(C.o,null,e.createElement(s.SettingsPageTitle,{name:"Roles"}),e.createElement(Q.J9,{enableReinitialize:!0,initialValues:{name:"",description:""},onSubmit:N,validationSchema:pe},({handleSubmit:$,values:O,handleChange:F,errors:I})=>e.createElement(s.Form,{noValidate:!0,onSubmit:$},e.createElement(f.T,{primaryAction:!y&&e.createElement(T.z,{type:"submit",loading:r,startIcon:e.createElement(k.Z,null)},n({id:"global.save",defaultMessage:"Save"})),title:n({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:n({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"})}),e.createElement(b.D,null,e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:7},e.createElement(P.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(g.Z,{variant:"delta",as:"h2"},n({id:(0,H.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),e.createElement(B.r,{gap:4},e.createElement(M.P,{col:6},e.createElement(U.o,{name:"name",value:O.name||"",onChange:F,label:n({id:"global.name",defaultMessage:"Name"}),error:I.name?n({id:I.name,defaultMessage:"Invalid value"}):null})),e.createElement(M.P,{col:6},e.createElement(Z.g,{id:"description",value:O.description||"",onChange:F,label:n({id:"global.description",defaultMessage:"Description"}),error:I.description?n({id:I.description,defaultMessage:"Invalid value"}):null}))))),!y&&e.createElement(me,{ref:D,permissions:R,routes:p}))))))},lt=()=>e.createElement(s.CheckPagePermissions,{permissions:l.Z.createRole},e.createElement(it,null));var ct=t(67109);const dt=()=>{const{formatMessage:n}=(0,x.Z)(),[r,a]=(0,e.useState)(!1),c=(0,s.useNotification)(),{lockApp:m,unlockApp:d}=(0,s.useOverlayBlocker)(),{params:{id:h}}=(0,o.$B)(`/settings/${i.Z}/roles/:id`),{isLoading:y,routes:R}=ge(),{role:p,onSubmitSucceeded:L,isLoading:D}=ot(h),u=(0,e.useRef)(),{put:N}=(0,s.useFetchClient)(),$=async O=>{m(),a(!0);try{const F=u.current.getPermissions();await N(`/${i.Z}/roles/${h}`,{...O,...F,users:[]}),L({name:O.name,description:O.description}),c({type:"success",message:{id:(0,H.Z)("Settings.roles.edited"),defaultMessage:"Role edited"}})}catch(F){console.error(F),c({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}a(!1),d()};return D?e.createElement(s.LoadingIndicatorPage,null):e.createElement(C.o,null,e.createElement(s.SettingsPageTitle,{name:"Roles"}),e.createElement(Q.J9,{enableReinitialize:!0,initialValues:{name:p.name,description:p.description},onSubmit:$,validationSchema:pe},({handleSubmit:O,values:F,handleChange:I,errors:w})=>e.createElement(s.Form,{noValidate:!0,onSubmit:O},e.createElement(f.T,{primaryAction:!y&&e.createElement(T.z,{disabled:p.code==="strapi-super-admin",type:"submit",loading:r,startIcon:e.createElement(k.Z,null)},n({id:"global.save",defaultMessage:"Save"})),title:p.name,subtitle:p.description,navigationAction:e.createElement(s.Link,{startIcon:e.createElement(ct.Z,null),to:"/settings/users-permissions/roles"},n({id:"global.back",defaultMessage:"Back"}))}),e.createElement(b.D,null,e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:7},e.createElement(P.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(g.Z,{variant:"delta",as:"h2"},n({id:(0,H.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),e.createElement(B.r,{gap:4},e.createElement(M.P,{col:6},e.createElement(U.o,{name:"name",value:F.name||"",onChange:I,label:n({id:"global.name",defaultMessage:"Name"}),error:w.name?n({id:w.name,defaultMessage:"Invalid value"}):null})),e.createElement(M.P,{col:6},e.createElement(Z.g,{id:"description",value:F.description||"",onChange:I,label:n({id:"global.description",defaultMessage:"Description"}),error:w.description?n({id:w.description,defaultMessage:"Invalid value"}):null}))))),!y&&e.createElement(me,{ref:u,permissions:p.permissions,routes:R}))))))},ut=()=>e.createElement(s.CheckPagePermissions,{permissions:l.Z.updateRole},e.createElement(dt,null));var mt=t(14087),gt=t(17034),pt=t(36989),Et=t(38939),ft=t(8060),Ee=t(79031),j=t(37909),ht=t(96315),yt=t(15234),fe=t(12028),Ct=t(4585),Rt=t(20022);const te=({sortedRoles:n,canDelete:r,permissions:a,setRoleToDelete:c,onDelete:m})=>{const{formatMessage:d}=(0,x.Z)(),{push:h}=(0,o.k6)(),[y,R]=m,p=u=>r&&!["public","authenticated"].includes(u.type),L=u=>{c(u),R(!y)},D=u=>{h(`/settings/${i.Z}/roles/${u}`)};return e.createElement(yt.p,null,n?.map(u=>e.createElement(Ee.Tr,{key:u.name,...(0,s.onRowClick)({fn:()=>D(u.id)})},e.createElement(j.Td,{width:"20%"},e.createElement(g.Z,null,u.name)),e.createElement(j.Td,{width:"50%"},e.createElement(g.Z,null,u.description)),e.createElement(j.Td,{width:"30%"},e.createElement(g.Z,null,`${u.nb_users} ${d({id:"global.users",defaultMessage:"users"}).toLowerCase()}`)),e.createElement(j.Td,null,e.createElement(v.k,{justifyContent:"end",...s.stopPropagation},e.createElement(s.CheckPermissions,{permissions:a.updateRole},e.createElement(fe.h,{onClick:()=>D(u.id),noBorder:!0,icon:e.createElement(Ct.Z,null),label:d({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:`${u.name}`})})),p(u)&&e.createElement(s.CheckPermissions,{permissions:a.deleteRole},e.createElement(fe.h,{onClick:()=>L(u.id),noBorder:!0,icon:e.createElement(Rt.Z,null),label:d({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${u.name}`})})))))))},vt=te;te.defaultProps={canDelete:!1},te.propTypes={onDelete:S().array.isRequired,permissions:S().object.isRequired,setRoleToDelete:S().func.isRequired,sortedRoles:S().array.isRequired,canDelete:S().bool};const Pt=async(n,r)=>{try{const{get:a}=(0,s.getFetchClient)(),{data:c}=await a((0,W.Gc)("roles"));return r("The roles have loaded successfully"),c}catch(a){throw n({type:"warning",message:{id:"notification.error"}}),new Error(a)}},At=async(n,r)=>{try{const{del:a}=(0,s.getFetchClient)();await a(`${(0,W.Gc)("roles")}/${n}`)}catch{r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}},Tt=()=>{const{trackUsage:n}=(0,s.useTracking)(),{formatMessage:r,locale:a}=(0,x.Z)(),{push:c}=(0,o.k6)(),m=(0,s.useNotification)(),{notifyStatus:d}=(0,mt.G)(),[{query:h}]=(0,s.useQueryParams)(),y=h?._q||"",[R,p]=(0,e.useState)(!1),[L,D]=(0,e.useState)(!1),[u,N]=(0,e.useState)();(0,s.useFocusWhenNavigate)();const $=(0,Y.useQueryClient)(),O=(0,e.useMemo)(()=>({create:l.Z.createRole,read:l.Z.readRoles,update:l.Z.updateRole,delete:l.Z.deleteRole}),[]),{isLoading:F,allowedActions:{canRead:I,canDelete:w}}=(0,s.useRBAC)(O),{isLoading:Lt,data:{roles:he},isFetching:xt}=(0,Y.useQuery)("get-roles",()=>Pt(m,d),{initialData:{},enabled:I}),{includes:ye}=(0,s.useFilter)(a,{sensitivity:"base"}),Ce=(0,s.useCollator)(a,{sensitivity:"base"}),Re=Lt||xt,St=()=>{n("willCreateRole"),c(`/settings/${i.Z}/roles/new`)},Mt=()=>{p(!R)},Zt={roles:{id:(0,W.OB)("Roles.empty"),defaultMessage:"You don't have any roles yet."},search:{id:(0,W.OB)("Roles.empty.search"),defaultMessage:"No roles match the search."}},Ot=r({id:"global.roles",defaultMessage:"Roles"}),Bt=(0,Y.useMutation)(V=>At(V,m),{async onSuccess(){await $.invalidateQueries("get-roles")}}),Ut=async()=>{D(!0),await Bt.mutateAsync(u),p(!R),D(!1)},J=(he||[]).filter(V=>ye(V.name,y)||ye(V.description,y)).sort((V,ve)=>Ce.compare(V.name,ve.name)||Ce.compare(V.description,ve.description)),kt=y&&!J.length?"search":"roles",Nt=4,Ft=(he?.length||0)+1;return e.createElement(gt.A,null,e.createElement(s.SettingsPageTitle,{name:Ot}),e.createElement(C.o,{"aria-busy":Re},e.createElement(f.T,{title:r({id:"global.roles",defaultMessage:"Roles"}),subtitle:r({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),primaryAction:e.createElement(s.CheckPermissions,{permissions:l.Z.createRole},e.createElement(T.z,{onClick:St,startIcon:e.createElement(ht.Z,null),size:"S"},r({id:(0,W.OB)("List.button.roles"),defaultMessage:"Add new role"})))}),e.createElement(pt.Z,{startActions:e.createElement(s.SearchURLQuery,{label:r({id:"app.component.search.label",defaultMessage:"Search"})})}),e.createElement(b.D,null,!I&&e.createElement(s.NoPermissions,null),(Re||F)&&e.createElement(s.LoadingIndicatorPage,null),I&&J&&J?.length?e.createElement(Et.i,{colCount:Nt,rowCount:Ft},e.createElement(ft.h,null,e.createElement(Ee.Tr,null,e.createElement(j.Th,null,e.createElement(g.Z,{variant:"sigma",textColor:"neutral600"},r({id:"global.name",defaultMessage:"Name"}))),e.createElement(j.Th,null,e.createElement(g.Z,{variant:"sigma",textColor:"neutral600"},r({id:"global.description",defaultMessage:"Description"}))),e.createElement(j.Th,null,e.createElement(g.Z,{variant:"sigma",textColor:"neutral600"},r({id:"global.users",defaultMessage:"Users"}))),e.createElement(j.Th,null,e.createElement(oe.T,null,r({id:"global.actions",defaultMessage:"Actions"}))))),e.createElement(vt,{sortedRoles:J,canDelete:w,permissions:l.Z,setRoleToDelete:N,onDelete:[R,p]})):e.createElement(s.EmptyStateLayout,{content:Zt[kt]})),e.createElement(s.ConfirmDialog,{isConfirmButtonLoading:L,onConfirm:Ut,onToggleDialog:Mt,isOpen:R})))},bt=()=>e.createElement(s.CheckPagePermissions,{permissions:l.Z.accessRoles},e.createElement(Tt,null)),Dt=()=>e.createElement(s.CheckPagePermissions,{permissions:l.Z.accessRoles},e.createElement(o.rs,null,e.createElement(o.AW,{path:`/settings/${i.Z}/roles/new`,component:lt,exact:!0}),e.createElement(o.AW,{path:`/settings/${i.Z}/roles/:id`,component:ut,exact:!0}),e.createElement(o.AW,{path:`/settings/${i.Z}/roles`,component:bt,exact:!0}),e.createElement(o.AW,{path:"",component:s.AnErrorOccurred})))},89031:(E,A,t)=>{"use strict";t.d(A,{YX:()=>l,Gc:()=>f,OB:()=>T.Z});var e=t(41609),s=t.n(e);const l=b=>Object.keys(b).reduce((v,P)=>{const g=b[P].controllers,B=Object.keys(g).reduce((M,U)=>(s()(g[U])||(M[U]=g[U]),M),{});return s()(B)||(v[P]={controllers:B}),v},{});var i=t(31498);const f=b=>`/${i.Z}/${b}`;var T=t(84757)},47443:(E,A,t)=>{var e=t(42118);function s(o,l){var i=o==null?0:o.length;return!!i&&e(o,l,0)>-1}E.exports=s},1196:E=>{function A(t,e,s){for(var o=-1,l=t==null?0:t.length;++o<l;)if(s(e,t[o]))return!0;return!1}E.exports=A},20731:(E,A,t)=>{var e=t(88668),s=t(47443),o=t(1196),l=t(29932),i=t(7518),C=t(74757),f=200;function T(b,v,P,g){var B=-1,M=s,U=!0,Z=b.length,k=[],Q=v.length;if(!Z)return k;P&&(v=l(v,i(P))),g?(M=o,U=!1):v.length>=f&&(M=C,U=!1,v=new e(v));e:for(;++B<Z;){var x=b[B],G=P==null?x:P(x);if(x=g||x!==0?x:0,U&&G===G){for(var S=Q;S--;)if(v[S]===G)continue e;k.push(x)}else M(v,G,g)||k.push(x)}return k}E.exports=T},89881:(E,A,t)=>{var e=t(47816),s=t(99291),o=s(e);E.exports=o},41848:E=>{function A(t,e,s,o){for(var l=t.length,i=s+(o?1:-1);o?i--:++i<l;)if(e(t[i],i,t))return i;return-1}E.exports=A},42118:(E,A,t)=>{var e=t(41848),s=t(62722),o=t(42351);function l(i,C,f){return C===C?o(i,C,f):e(i,s,f)}E.exports=l},62722:E=>{function A(t){return t!==t}E.exports=A},69199:(E,A,t)=>{var e=t(89881),s=t(98612);function o(l,i){var C=-1,f=s(l)?Array(l.length):[];return e(l,function(T,b,v){f[++C]=i(T,b,v)}),f}E.exports=o},82689:(E,A,t)=>{var e=t(29932),s=t(97786),o=t(67206),l=t(69199),i=t(71131),C=t(7518),f=t(85022),T=t(6557),b=t(1469);function v(P,g,B){g.length?g=e(g,function(Z){return b(Z)?function(k){return s(k,Z.length===1?Z[0]:Z)}:Z}):g=[T];var M=-1;g=e(g,C(o));var U=l(P,function(Z,k,Q){var x=e(g,function(G){return G(Z)});return{criteria:x,index:++M,value:Z}});return i(U,function(Z,k){return f(Z,k,B)})}E.exports=v},71131:E=>{function A(t,e){var s=t.length;for(t.sort(e);s--;)t[s]=t[s].value;return t}E.exports=A},26393:(E,A,t)=>{var e=t(33448);function s(o,l){if(o!==l){var i=o!==void 0,C=o===null,f=o===o,T=e(o),b=l!==void 0,v=l===null,P=l===l,g=e(l);if(!v&&!g&&!T&&o>l||T&&b&&P&&!v&&!g||C&&b&&P||!i&&P||!f)return 1;if(!C&&!T&&!g&&o<l||g&&i&&f&&!C&&!T||v&&i&&f||!b&&f||!P)return-1}return 0}E.exports=s},85022:(E,A,t)=>{var e=t(26393);function s(o,l,i){for(var C=-1,f=o.criteria,T=l.criteria,b=f.length,v=i.length;++C<b;){var P=e(f[C],T[C]);if(P){if(C>=v)return P;var g=i[C];return P*(g=="desc"?-1:1)}}return o.index-l.index}E.exports=s},99291:(E,A,t)=>{var e=t(98612);function s(o,l){return function(i,C){if(i==null)return i;if(!e(i))return o(i,C);for(var f=i.length,T=l?f:-1,b=Object(i);(l?T--:++T<f)&&C(b[T],T,b)!==!1;);return i}}E.exports=s},42351:E=>{function A(t,e,s){for(var o=s-1,l=t.length;++o<l;)if(t[o]===e)return o;return-1}E.exports=A},70174:(E,A,t)=>{var e=t(29932),s=t(67206),o=t(69199),l=t(1469);function i(C,f){var T=l(C)?e:o;return T(C,s(f,3))}E.exports=i},89734:(E,A,t)=>{var e=t(21078),s=t(82689),o=t(5976),l=t(16612),i=o(function(C,f){if(C==null)return[];var T=f.length;return T>1&&l(C,f[0],f[1])?f=[]:T>2&&l(f[0],f[1],f[2])&&(f=[f[0]]),s(C,e(f,1),[])});E.exports=i},13217:(E,A,t)=>{var e=t(14259);function s(o){var l=o==null?0:o.length;return l?e(o,1,l):[]}E.exports=s},69572:(E,A,t)=>{var e=t(14259),s=t(40554);function o(l,i,C){return l&&l.length?(i=C||i===void 0?1:s(i),e(l,0,i<0?0:i)):[]}E.exports=o},82569:(E,A,t)=>{var e=t(20731),s=t(5976),o=t(29246),l=s(function(i,C){return o(i)?e(i,C):[]});E.exports=l}}]);
