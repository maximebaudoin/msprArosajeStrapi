(self.webpackChunkmspr_arosaje_strapi=self.webpackChunkmspr_arosaje_strapi||[]).push([[7692],{76539:(h,E,t)=>{"use strict";t.d(E,{Z:()=>P});var e=t(53547),p=t(53979),r=t(11047),o=t(29728),a=t(42609),i=t(85018),u=t(67109),A=t(45697),s=t.n(A),v=t(86896),n=t(30815),f=t(51319);const T=({onRegenerate:R,idToRegenerate:D,backUrl:b,onError:Z})=>{const{formatMessage:k}=(0,v.Z)(),[F,B]=(0,e.useState)(!1),{regenerateData:G,isLoadingConfirmation:X}=(0,f.rW)(b,D,R,Z),$=async()=>{G(),B(!1)};return e.createElement(e.Fragment,null,e.createElement(o.z,{startIcon:e.createElement(n.default,null),type:"button",size:"S",variant:"tertiary",onClick:()=>B(!0),name:"regenerate"},k({id:"Settings.tokens.regenerate",defaultMessage:"Regenerate"})),e.createElement(a.ConfirmDialog,{bodyText:{id:"Settings.tokens.popUpWarning.message",defaultMessage:"Are you sure you want to regenerate this token?"},iconRightButton:e.createElement(n.default,null),isConfirmButtonLoading:X,isOpen:F,onToggleDialog:()=>B(!1),onConfirm:$,leftButtonText:{id:"Settings.tokens.Button.cancel",defaultMessage:"Cancel"},rightButtonText:{id:"Settings.tokens.Button.regenerate",defaultMessage:"Regenerate"},title:{id:"Settings.tokens.RegenerateDialog.title",defaultMessage:"Regenerate token"}}))};T.defaultProps={onRegenerate(){},onError:void 0},T.propTypes={onRegenerate:s().func,idToRegenerate:s().oneOfType([s().number,s().string]).isRequired,backUrl:s().string.isRequired,onError:s().func};const C=T,O=({title:R,token:D,setToken:b,canEditInputs:Z,canRegenerate:k,isSubmitting:F,backUrl:B,regenerateUrl:G,onErrorRegenerate:X})=>{const{formatMessage:$}=(0,v.Z)(),w=Y=>{b({...D,accessKey:Y})};return e.createElement(p.T,{title:D?.name||$(R),primaryAction:Z?e.createElement(r.k,{gap:2},k&&D?.id&&e.createElement(C,{backUrl:G,onRegenerate:w,idToRegenerate:D?.id,onError:X}),e.createElement(o.z,{disabled:F,loading:F,startIcon:e.createElement(i.Z,null),type:"submit",size:"S"},$({id:"global.save",defaultMessage:"Save"}))):k&&D?.id&&e.createElement(C,{onRegenerate:w,idToRegenerate:D?.id,backUrl:G}),navigationAction:e.createElement(a.Link,{startIcon:e.createElement(u.Z,null),to:B},$({id:"global.back",defaultMessage:"Back"})),ellipsis:!0})};O.propTypes={token:s().shape({id:s().oneOfType([s().number,s().string]),type:s().string,lifespan:s().oneOfType([s().number,s().string]),name:s().string,accessKey:s().string,permissions:s().array,description:s().string,createdAt:s().string}),canEditInputs:s().bool.isRequired,canRegenerate:s().bool.isRequired,setToken:s().func.isRequired,isSubmitting:s().bool.isRequired,backUrl:s().string.isRequired,title:s().shape({id:s().string,label:s().string}).isRequired,regenerateUrl:s().string.isRequired,onErrorRegenerate:s().func},O.defaultProps={token:void 0,onErrorRegenerate:void 0};const P=O},60401:(h,E,t)=>{"use strict";t.d(E,{Z:()=>v});var e=t(53547),p=t(40619),r=t(82562),o=t(84170),a=t(45697),i=t.n(a),u=t(86896),A=t(75056);const s=({token:n,errors:f,values:T,onChange:C,isCreating:O})=>{const{formatMessage:P}=(0,u.Z)();return e.createElement(e.Fragment,null,e.createElement(p.P,{name:"lifespan",label:P({id:"Settings.tokens.form.duration",defaultMessage:"Token duration"}),value:T.lifespan!==null?T.lifespan:"0",error:f.lifespan?P(f.lifespan?.id?f.lifespan:{id:f.lifespan,defaultMessage:f.lifespan}):null,onChange:R=>{C({target:{name:"lifespan",value:R}})},required:!0,disabled:!O,placeholder:"Select"},e.createElement(r.W,{value:"604800000"},P({id:"Settings.tokens.duration.7-days",defaultMessage:"7 days"})),e.createElement(r.W,{value:"2592000000"},P({id:"Settings.tokens.duration.30-days",defaultMessage:"30 days"})),e.createElement(r.W,{value:"7776000000"},P({id:"Settings.tokens.duration.90-days",defaultMessage:"90 days"})),e.createElement(r.W,{value:"0"},P({id:"Settings.tokens.duration.unlimited",defaultMessage:"Unlimited"}))),e.createElement(o.Z,{variant:"pi",textColor:"neutral600"},!O&&`${P({id:"Settings.tokens.duration.expiration-date",defaultMessage:"Expiration date"})}: ${(0,A.IX)(n?.createdAt,parseInt(T.lifespan,10))}`))};s.propTypes={errors:i().shape({lifespan:i().string}),onChange:i().func.isRequired,values:i().shape({lifespan:i().oneOfType([i().number,i().string])}).isRequired,isCreating:i().bool.isRequired,token:i().shape({id:i().oneOfType([i().number,i().string]),type:i().string,lifespan:i().string,name:i().string,accessKey:i().string,permissions:i().array,description:i().string,createdAt:i().string})},s.defaultProps={errors:{},token:{}};const v=s},24122:(h,E,t)=>{"use strict";t.d(E,{Z:()=>v});var e=t(53547),p=t(12028),r=t(42609),o=t(65186),a=t(69427),i=t(45697),u=t.n(i),A=t(86896);const s=({token:n,tokenType:f})=>{const{formatMessage:T}=(0,A.Z)(),C=(0,r.useNotification)(),{trackUsage:O}=(0,r.useTracking)(),{copy:P}=(0,r.useClipboard)(),R=D=>async()=>{await P(D)&&(O.current("didCopyTokenKey",{tokenType:f}),C({type:"success",message:{id:"Settings.tokens.notification.copied"}}))};return e.createElement(r.ContentBox,{endAction:n&&e.createElement("span",{style:{alignSelf:"start"}},e.createElement(p.h,{label:T({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),onClick:R(n),noBorder:!0,icon:e.createElement(o.Z,null),style:{padding:0,height:"1rem"}})),title:n||T({id:"Settings.tokens.copy.editTitle",defaultMessage:"This token isn\u2019t accessible anymore."}),subtitle:T(n?{id:"Settings.tokens.copy.lastWarning",defaultMessage:"Make sure to copy this token, you won\u2019t be able to see it again!"}:{id:"Settings.tokens.copy.editMessage",defaultMessage:"For security reasons, you can only see your token once."}),icon:e.createElement(a.Z,null),iconBackground:"neutral100"})};s.defaultProps={token:null},s.propTypes={token:u().string,tokenType:u().string.isRequired};const v=s},40695:(h,E,t)=>{"use strict";t.d(E,{Z:()=>u});var e=t(53547),p=t(61467),r=t(45697),o=t.n(r),a=t(86896);const i=({errors:A,values:s,onChange:v,canEditInputs:n})=>{const{formatMessage:f}=(0,a.Z)();return e.createElement(p.g,{label:f({id:"Settings.tokens.form.description",defaultMessage:"Description"}),id:"description",error:A.description?f(A.description?.id?A.description:{id:A.description,defaultMessage:A.description}):null,onChange:v,disabled:!n},s.description)};i.propTypes={errors:o().shape({description:o().string}),onChange:o().func.isRequired,canEditInputs:o().bool.isRequired,values:o().shape({description:o().string}).isRequired},i.defaultProps={errors:{}};const u=i},61053:(h,E,t)=>{"use strict";t.d(E,{Z:()=>u});var e=t(53547),p=t(16364),r=t(45697),o=t.n(r),a=t(86896);const i=({errors:A,values:s,onChange:v,canEditInputs:n})=>{const{formatMessage:f}=(0,a.Z)();return e.createElement(p.o,{name:"name",error:A.name?f(A.name?.id?A.name:{id:A.name,defaultMessage:A.name}):null,label:f({id:"Settings.tokens.form.name",defaultMessage:"Name"}),onChange:v,value:s.name,disabled:!n,required:!0})};i.propTypes={errors:o().shape({name:o().string}),onChange:o().func.isRequired,canEditInputs:o().bool.isRequired,values:o().shape({name:o().string}).isRequired},i.defaultProps={errors:{}};const u=i},31065:(h,E,t)=>{"use strict";t.d(E,{Z:()=>A});var e=t(53547),p=t(40619),r=t(82562),o=t(45697),a=t.n(o),i=t(86896);const u=({name:s,errors:v,values:n,onChange:f,canEditInputs:T,options:C,label:O})=>{const{formatMessage:P}=(0,i.Z)();return e.createElement(p.P,{name:s,label:P({id:O.id,defaultMessage:O.defaultMessage}),value:n&&n[s],error:v[s]?P(v[s]?.id?v[s]:{id:v[s],defaultMessage:v[s]}):null,onChange:f,placeholder:"Select",required:!0,disabled:!T},C&&C.map(({value:R,label:D})=>e.createElement(r.W,{key:R,value:R},P(D))))};u.propTypes={name:a().string,options:a().arrayOf(a().shape({label:a().shape({id:a().string,defaultMessage:a().string}),value:a().string})),errors:a().shape({type:a().string}),onChange:a().func.isRequired,canEditInputs:a().bool.isRequired,values:a().shape({type:a().string}).isRequired,label:a().shape({id:a().string,defaultMessage:a().string}).isRequired},u.defaultProps={name:"type",errors:{},options:[]};const A=u},47670:(h,E,t)=>{"use strict";t.d(E,{Z:()=>e,f:()=>p});const e="api-token",p="transfer-token"},57692:(h,E,t)=>{"use strict";t.d(E,{Z:()=>Ge});var e=t(53547),p=t(185),r=t(49066),o=t(11047),a=t(42609),i=t(41054),u=t(86896),A=t(88767),s=t(16550),v=t(45697),n=t.n(v);const f=(0,e.createContext)({}),T=({children:l,...d})=>e.createElement(f.Provider,{value:d},l),C=()=>(0,e.useContext)(f);T.propTypes={children:n().node.isRequired};var O=t(87751),P=t(19631),R=t(47670),D=t(76539),b=t(24122),Z=t(41580),k=t(84170),F=t(11276),B=t(67819),G=t(60401),X=t(40695),$=t(61053),w=t(31065);const Y=({errors:l,onChange:d,canEditInputs:c,isCreating:I,values:y,apiToken:g,onDispatch:N,setHasChangedPermissions:H})=>{const{formatMessage:U}=(0,u.Z)(),K=({target:{value:W}})=>{H(!1),W==="full-access"&&N({type:"SELECT_ALL_ACTIONS"}),W==="read-only"&&N({type:"ON_CHANGE_READ_ONLY"})},j=[{value:"read-only",label:{id:"Settings.tokens.types.read-only",defaultMessage:"Read-only"}},{value:"full-access",label:{id:"Settings.tokens.types.full-access",defaultMessage:"Full access"}},{value:"custom",label:{id:"Settings.tokens.types.custom",defaultMessage:"Custom"}}];return e.createElement(Z.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(o.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(k.Z,{variant:"delta",as:"h2"},U({id:"global.details",defaultMessage:"Details"})),e.createElement(F.r,{gap:5},e.createElement(B.P,{key:"name",col:6,xs:12},e.createElement($.Z,{errors:l,values:y,canEditInputs:c,onChange:d})),e.createElement(B.P,{key:"description",col:6,xs:12},e.createElement(X.Z,{errors:l,values:y,canEditInputs:c,onChange:d})),e.createElement(B.P,{key:"lifespan",col:6,xs:12},e.createElement(G.Z,{isCreating:I,errors:l,values:y,onChange:d,token:g})),e.createElement(B.P,{key:"type",col:6,xs:12},e.createElement(w.Z,{values:y,errors:l,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:W=>{K({target:{value:W}}),d({target:{name:"type",value:W}})},options:j,canEditInputs:c})))))};Y.propTypes={errors:n().shape({name:n().string,description:n().string,lifespan:n().string,type:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({name:n().string,description:n().string,lifespan:n().oneOfType([n().number,n().string]),type:n().string}).isRequired,isCreating:n().bool.isRequired,apiToken:n().shape({id:n().oneOfType([n().number,n().string]),type:n().string,lifespan:n().string,name:n().string,accessKey:n().string,permissions:n().array,description:n().string,createdAt:n().string}),onDispatch:n().func.isRequired,setHasChangedPermissions:n().func.isRequired},Y.defaultProps={errors:{},apiToken:{}};const ge=Y;var me=t(53979),Ee=t(29728),fe=t(85018);const te=({apiTokenName:l})=>{const{formatMessage:d}=(0,u.Z)();return(0,a.useFocusWhenNavigate)(),e.createElement(p.o,{"aria-busy":"true"},e.createElement(a.SettingsPageTitle,{name:"API Tokens"}),e.createElement(me.T,{primaryAction:e.createElement(Ee.z,{disabled:!0,startIcon:e.createElement(fe.Z,null),type:"button",size:"L"},d({id:"global.save",defaultMessage:"Save"})),title:l||d({id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"})}),e.createElement(r.D,null,e.createElement(a.LoadingIndicatorPage,null)))};te.defaultProps={apiTokenName:null},te.propTypes={apiTokenName:n().string};const ye=te;var Te=t(70174),he=t.n(Te),Ae=t(13217),ve=t.n(Ae),_=t(88972);const Ce=l=>{switch(l){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Pe=(0,_.ZP)(Z.x)`
  margin: -1px;
  border-radius: ${({theme:l})=>l.spaces[1]} 0 0 ${({theme:l})=>l.spaces[1]};
`;function ne({route:l}){const{formatMessage:d}=(0,u.Z)(),{method:c,handler:I,path:y}=l,g=y?ve()(y.split("/")):[],[N="",H=""]=I?I.split("."):[],U=Ce(l.method);return e.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(k.Z,{variant:"delta",as:"h3"},d({id:"Settings.apiTokens.createPage.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",e.createElement("span",null,N),e.createElement(k.Z,{variant:"delta",textColor:"primary600"},".",H)),e.createElement(o.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0},e.createElement(Pe,{background:U.background,borderColor:U.border,padding:2},e.createElement(k.Z,{fontWeight:"bold",textColor:U.text},c)),e.createElement(Z.x,{paddingLeft:2,paddingRight:2},he()(g,K=>e.createElement(k.Z,{key:K,textColor:K.includes(":")?"neutral600":"neutral900"},"/",K)))))}ne.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},ne.propTypes={route:n().shape({handler:n().string,method:n().string,path:n().string})};const Me=ne,Re=()=>{const{value:{selectedAction:l,routes:d}}=C(),{formatMessage:c}=(0,u.Z)(),I=l?.split(".")[0];return e.createElement(B.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},l?e.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},d[I]?.map(y=>y.config.auth?.scope?.includes(l)||y.handler===l?e.createElement(Me,{key:y.handler,route:y}):null)):e.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(k.Z,{variant:"delta",as:"h3"},c({id:"Settings.apiTokens.createPage.permissions.header.title",defaultMessage:"Advanced settings"})),e.createElement(k.Z,{as:"p",textColor:"neutral600"},c({id:"Settings.apiTokens.createPage.permissions.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))};var Oe=t(48734),Ie=t(74756),De=t(63081),ce=t(36213),ke=t(78114),Se=t(48403),xe=t.n(Se);const pe=(0,_.iv)`
  background: ${l=>l.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,Le=(0,_.ZP)(Z.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${l=>l.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${l=>l.isActive&&pe}
  &:hover {
    ${pe}
  }
`,Be=_.ZP.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:l})=>l.colors.neutral150};
`,se=({controllers:l,label:d,orderNumber:c,disabled:I,onExpanded:y,indexExpandendCollapsedContent:g})=>{const{value:{onChangeSelectAll:N,onChange:H,selectedActions:U,setSelectedAction:K,selectedAction:j}}=C(),[W,q]=(0,e.useState)(!1),{formatMessage:Q}=(0,u.Z)(),x=()=>{q(L=>!L),y(c)};(0,e.useEffect)(()=>{g!==null&&g!==c&&W&&q(!1)},[g,c,W]);const z=L=>L===j;return e.createElement(Oe.U,{expanded:W,onToggle:x,variant:c%2?"primary":"secondary"},e.createElement(Ie.B,{title:xe()(d)}),e.createElement(De.v,null,l?.map(L=>{const ee=L.actions.every(M=>U.includes(M.actionId)),ie=L.actions.some(M=>U.includes(M.actionId));return e.createElement(Z.x,{key:`${d}.${L?.controller}`},e.createElement(o.k,{justifyContent:"space-between",alignItems:"center",padding:4},e.createElement(Z.x,{paddingRight:4},e.createElement(k.Z,{variant:"sigma",textColor:"neutral600"},L?.controller)),e.createElement(Be,null),e.createElement(Z.x,{paddingLeft:4},e.createElement(ce.X,{value:ee,indeterminate:!ee&&ie,onValueChange:()=>{N({target:{value:[...L.actions]}})},disabled:I},Q({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(F.r,{gap:4,padding:4},L?.actions&&L?.actions.map(M=>e.createElement(B.P,{col:6,key:M.actionId},e.createElement(Le,{isActive:z(M.actionId),padding:2,hasRadius:!0},e.createElement(ce.X,{value:U.includes(M.actionId),name:M.actionId,onValueChange:()=>{H({target:{value:M.actionId}})},disabled:I},M.action),e.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>K({target:{value:M.actionId}}),style:{display:"inline-flex",alignItems:"center"}},e.createElement(ke.Z,null)))))))})))};se.defaultProps={controllers:[],orderNumber:0,disabled:!1,onExpanded:()=>null,indexExpandendCollapsedContent:null},se.propTypes={controllers:n().array,orderNumber:n().number,label:n().string.isRequired,disabled:n().bool,onExpanded:n().func,indexExpandendCollapsedContent:n().number};const Ue=se,ae=({section:l,...d})=>{const[c,I]=(0,e.useState)(null),y=g=>I(g);return e.createElement(Z.x,{padding:4,background:"neutral0"},l&&l.map((g,N)=>e.createElement(Ue,{key:g.apiId,label:g.label,controllers:g.controllers,orderNumber:N,indexExpandendCollapsedContent:c,onExpanded:y,name:g.apiId,...d})))};ae.defaultProps={section:null},ae.propTypes={section:n().arrayOf(n().object)};const Ze=ae,Ne=({...l})=>{const{value:{data:d}}=C(),{formatMessage:c}=(0,u.Z)();return e.createElement(F.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},e.createElement(B.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(o.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(k.Z,{variant:"delta",as:"h2"},c({id:"Settings.apiTokens.createPage.permissions.title",defaultMessage:"Permissions"})),e.createElement(k.Z,{as:"p",textColor:"neutral600"},c({id:"Settings.apiTokens.createPage.permissions.description",defaultMessage:"Only actions bound by a route are listed below."}))),d?.permissions&&e.createElement(Ze,{section:d?.permissions,...l})),e.createElement(Re,null))},We=(0,e.memo)(Ne);var oe=t(75056);const Ke=(l,d=[])=>({...l,selectedAction:null,routes:[],selectedActions:[],data:(0,oe.mk)(d)});var be=t(18172),Fe=t(97019),ue=t.n(Fe);const $e={data:{},selectedActions:[]},He=(l,d)=>(0,be.ZP)(l,c=>{switch(d.type){case"ON_CHANGE":{c.selectedActions.includes(d.value)?ue()(c.selectedActions,d.value):c.selectedActions.push(d.value);break}case"SELECT_ALL_IN_PERMISSION":{d.value.every(y=>c.selectedActions.includes(y.actionId))?d.value.forEach(y=>{ue()(c.selectedActions,y.actionId)}):d.value.forEach(y=>{c.selectedActions.push(y.actionId)});break}case"SELECT_ALL_ACTIONS":{c.selectedActions=[...c.data.allActionsIds];break}case"ON_CHANGE_READ_ONLY":{const I=c.data.allActionsIds.filter(y=>y.includes("find")||y.includes("findOne"));c.selectedActions=[...I];break}case"UPDATE_PERMISSIONS_LAYOUT":{c.data=(0,oe.mk)(d.value);break}case"UPDATE_ROUTES":{c.routes={...d.value};break}case"UPDATE_PERMISSIONS":{c.selectedActions=[...d.value];break}case"SET_SELECTED_ACTION":{c.selectedAction=d.value;break}default:return c}}),Ve="Name already taken",Ge=()=>{(0,a.useFocusWhenNavigate)();const{formatMessage:l}=(0,u.Z)(),{lockApp:d,unlockApp:c}=(0,a.useOverlayBlocker)(),I=(0,a.useNotification)(),y=(0,s.k6)(),[g,N]=(0,e.useState)(y.location.state?.apiToken.accessKey?{...y.location.state.apiToken}:null),{trackUsage:H}=(0,a.useTracking)(),U=(0,e.useRef)(H),{setCurrentStep:K}=(0,a.useGuidedTour)(),{allowedActions:{canCreate:j,canUpdate:W,canRegenerate:q}}=(0,a.useRBAC)(O.Z.settings["api-tokens"]),[Q,x]=(0,e.useReducer)(He,$e,m=>Ke(m,{})),{params:{id:z}}=(0,s.$B)("/settings/api-tokens/:id"),{get:L,post:ee,put:ie}=(0,a.useFetchClient)(),M=z==="create";(0,A.useQuery)("content-api-permissions",async()=>{const[m,V]=await Promise.all(["/admin/content-api/permissions","/admin/content-api/routes"].map(async J=>{const{data:S}=await L(J);return S.data}));x({type:"UPDATE_PERMISSIONS_LAYOUT",value:m}),x({type:"UPDATE_ROUTES",value:V}),g&&(g?.type==="read-only"&&x({type:"ON_CHANGE_READ_ONLY"}),g?.type==="full-access"&&x({type:"SELECT_ALL_ACTIONS"}),g?.type==="custom"&&x({type:"UPDATE_PERMISSIONS",value:g?.permissions}))},{onError(){I({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),(0,e.useEffect)(()=>{U.current(M?"didAddTokenFromList":"didEditTokenFromList",{tokenType:R.Z})},[M]);const{status:ze}=(0,A.useQuery)(["api-token",z],async()=>{const{data:{data:m}}=await L(`/admin/api-tokens/${z}`);return N({...m}),m?.type==="read-only"&&x({type:"ON_CHANGE_READ_ONLY"}),m?.type==="full-access"&&x({type:"SELECT_ALL_ACTIONS"}),m?.type==="custom"&&x({type:"UPDATE_PERMISSIONS",value:m?.permissions}),m},{enabled:!M&&!g,onError(){I({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),Xe=async(m,V)=>{U.current(M?"willCreateToken":"willEditToken",{tokenType:R.Z}),d();const J=m.lifespan&&parseInt(m.lifespan,10)&&m.lifespan!=="0"?parseInt(m.lifespan,10):null;try{const{data:{data:S}}=M?await ee("/admin/api-tokens",{...m,lifespan:J,permissions:m.type==="custom"?Q.selectedActions:null}):await ie(`/admin/api-tokens/${z}`,{name:m.name,description:m.description,type:m.type,permissions:m.type==="custom"?Q.selectedActions:null});M&&(y.replace(`/settings/api-tokens/${S.id}`,{apiToken:S}),K("apiTokens.success")),c(),N({...S}),I({type:"success",message:l(M?{id:"notification.success.apitokencreated",defaultMessage:"API Token successfully created"}:{id:"notification.success.apitokenedited",defaultMessage:"API Token successfully edited"})}),U.current(M?"didCreateToken":"didEditToken",{type:g.type,tokenType:R.Z})}catch(S){const de=(0,P.Iz)(S.response.data);V.setErrors(de),S?.response?.data?.error?.message===Ve?I({type:"warning",message:S.response.data.message||"notification.error.tokennamenotunique"}):I({type:"warning",message:S?.response?.data?.message||"notification.error"}),c()}},[Ye,re]=(0,e.useState)(!1),je={...Q,onChange:({target:{value:m}})=>{re(!0),x({type:"ON_CHANGE",value:m})},onChangeSelectAll:({target:{value:m}})=>{re(!0),x({type:"SELECT_ALL_IN_PERMISSION",value:m})},setSelectedAction:({target:{value:m}})=>{x({type:"SET_SELECTED_ACTION",value:m})}},le=W&&!M||j&&M;return!M&&!g&&ze!=="success"?e.createElement(ye,{apiTokenName:g?.name}):e.createElement(T,{value:je},e.createElement(p.o,null,e.createElement(a.SettingsPageTitle,{name:"API Tokens"}),e.createElement(i.J9,{validationSchema:oe.fK,validateOnChange:!1,initialValues:{name:g?.name||"",description:g?.description||"",type:g?.type,lifespan:g?.lifespan?g.lifespan.toString():g?.lifespan},enableReinitialize:!0,onSubmit:(m,V)=>Xe(m,V)},({errors:m,handleChange:V,isSubmitting:J,values:S,setFieldValue:de})=>(Ye&&S?.type!=="custom"&&de("type","custom"),e.createElement(a.Form,null,e.createElement(D.Z,{backUrl:"/settings/api-tokens",title:{id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"},token:g,setToken:N,canEditInputs:le,canRegenerate:q,isSubmitting:J,regenerateUrl:"/admin/api-tokens/"}),e.createElement(r.D,null,e.createElement(o.k,{direction:"column",alignItems:"stretch",gap:6},Boolean(g?.name)&&e.createElement(b.Z,{token:g?.accessKey,tokenType:R.Z}),e.createElement(ge,{errors:m,onChange:V,canEditInputs:le,isCreating:M,values:S,apiToken:g,onDispatch:x,setHasChangedPermissions:re}),e.createElement(We,{disabled:!le||S?.type==="read-only"||S?.type==="full-access"}))))))))}},75056:(h,E,t)=>{"use strict";t.d(E,{IX:()=>a,fK:()=>s,mk:()=>n});var e=t(66115),p=t(77349),r=t(51991);const a=(f,T,C="en")=>{if(T&&typeof T=="number"){const O=T/24/60/60/1e3;return(0,e.Z)((0,p.Z)(new Date(f),O),"PPP",{locale:r[C]})}return"Unlimited"};var i=t(42609),u=t(87561);const s=u.Ry().shape({name:u.Z_(i.translatedErrors.string).max(100).required(i.translatedErrors.required),type:u.Z_(i.translatedErrors.string).oneOf(["read-only","full-access","custom"]).required(i.translatedErrors.required),description:u.Z_().nullable(),lifespan:u.Rx().integer().min(0).nullable().defined(i.translatedErrors.required)}),n=f=>{const T={allActionsIds:[],permissions:[]};return T.permissions=Object.keys(f).map(C=>({apiId:C,label:C.split("::")[1],controllers:Object.keys(f[C].controllers).map(O=>({controller:O,actions:f[C].controllers[O].map(P=>{const R=`${C}.${O}.${P}`;return C.includes("api::")&&T.allActionsIds.push(R),{action:P,actionId:R}}).flat()})).flat()})),T}},41848:h=>{function E(t,e,p,r){for(var o=t.length,a=p+(r?1:-1);r?a--:++a<o;)if(e(t[a],a,t))return a;return-1}h.exports=E},42118:(h,E,t)=>{var e=t(41848),p=t(62722),r=t(42351);function o(a,i,u){return i===i?r(a,i,u):e(a,p,u)}h.exports=o},74221:h=>{function E(t,e,p,r){for(var o=p-1,a=t.length;++o<a;)if(r(t[o],e))return o;return-1}h.exports=E},62722:h=>{function E(t){return t!==t}h.exports=E},65464:(h,E,t)=>{var e=t(29932),p=t(42118),r=t(74221),o=t(7518),a=t(278),i=Array.prototype,u=i.splice;function A(s,v,n,f){var T=f?r:p,C=-1,O=v.length,P=s;for(s===v&&(v=a(v)),n&&(P=e(s,o(n)));++C<O;)for(var R=0,D=v[C],b=n?n(D):D;(R=T(P,b,R,f))>-1;)P!==s&&u.call(P,R,1),u.call(s,R,1);return s}h.exports=A},42351:h=>{function E(t,e,p){for(var r=p-1,o=t.length;++r<o;)if(t[r]===e)return r;return-1}h.exports=E},97019:(h,E,t)=>{var e=t(5976),p=t(45604),r=e(p);h.exports=r},45604:(h,E,t)=>{var e=t(65464);function p(r,o){return r&&r.length&&o&&o.length?e(r,o):r}h.exports=p},13217:(h,E,t)=>{var e=t(14259);function p(r){var o=r==null?0:r.length;return o?e(r,1,o):[]}h.exports=p}}]);
