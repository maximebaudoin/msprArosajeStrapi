"use strict";(self.webpackChunkmspr_arosaje_strapi=self.webpackChunkmspr_arosaje_strapi||[]).push([[4121],{62872:(be,y,t)=>{t.r(y),t.d(y,{default:()=>ne});var e=t(53547),o=t(42609),w=t(87751),R=t(14087),F=t(17034),z=t(185),H=t(53979),O=t(36989),i=t(84170),k=t(29728),U=t(49066),j=t(41580),G=t(38939),Q=t(49386),Y=t(8060),Z=t(79031),l=t(37909),P=t(92155),K=t(63237),J=t(15234),x=t(11047),X=t(3566),D=t(12028),q=t(89722),f=t(96315),A=t(20022),_=t(4585),ee=t(86031),te=t(86896),v=t(88767),p=t(16550);const ae=()=>{const[se,c]=(0,e.useState)(!1),[b,r]=(0,e.useState)([]),{formatMessage:n}=(0,te.Z)(),{formatAPIError:m}=(0,o.useAPIErrorHandler)(),g=(0,o.useNotification)();(0,o.useFocusWhenNavigate)();const{push:oe}=(0,p.k6)(),{pathname:B}=(0,p.TH)(),{isLoading:le,allowedActions:{canCreate:C,canUpdate:W,canDelete:V}}=(0,o.useRBAC)(w.Z.settings.webhooks),{get:ie,post:re,put:de}=(0,o.useFetchClient)(),{notifyStatus:I}=(0,R.G)(),ce="webhooks",{isLoading:ue,data:d,error:T,refetch:$}=(0,v.useQuery)(ce,async()=>{const{data:{data:a}}=await ie("/admin/webhooks");return a});(0,e.useEffect)(()=>{if(T){g({type:"warning",message:m(T)});return}d&&I(n({id:"Settings.webhooks.list.loading.success",defaultMessage:"Webhooks have been loaded"}))},[d,T,g,n,I,m]);const N=(0,v.useMutation)(async()=>{await re("/admin/webhooks/batch-delete",{ids:b})},{onError(a){g({type:"warning",message:m(a)}),c(!1)},onSuccess(){r([]),c(!1),$()}}),me=(0,v.useMutation)(async({isEnabled:a,id:s})=>{const{id:E,...L}=d.find(ve=>ve.id===s)??{},fe={...L,isEnabled:a};await de(`/admin/webhooks/${s}`,fe)},{onError(a){g({type:"warning",message:m(a)})},onSuccess(){$()}}),ge=()=>N.mutate(),he=a=>r(a?d.map(s=>s.id):[]),Ee=(a,s)=>r(a?E=>[...E,s]:E=>E.filter(L=>L!==s)),S=a=>oe(`${B}/${a}`),M=le||ue,h=d?.length??0,u=b.length;return e.createElement(F.A,null,e.createElement(o.SettingsPageTitle,{name:"Webhooks"}),e.createElement(z.o,{"aria-busy":M},e.createElement(H.T,{title:n({id:"Settings.webhooks.title",defaultMessage:"Webhooks"}),subtitle:n({id:"Settings.webhooks.list.description",defaultMessage:"Get POST changes notifications"}),primaryAction:C&&!M&&e.createElement(o.LinkButton,{startIcon:e.createElement(f.Z,null),variant:"default",to:`${B}/create`,size:"S"},n({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"}))}),u>0&&V&&e.createElement(O.Z,{startActions:e.createElement(e.Fragment,null,e.createElement(i.Z,{variant:"epsilon",textColor:"neutral600"},n({id:"Settings.webhooks.to.delete",defaultMessage:"{webhooksToDeleteLength, plural, one {# webhook} other {# webhooks}} selected"},{webhooksToDeleteLength:u})),e.createElement(k.z,{onClick:()=>c(!0),startIcon:e.createElement(A.Z,null),size:"L",variant:"danger-light"},n({id:"global.delete",defaultMessage:"Delete"})))}),e.createElement(U.D,null,M?e.createElement(j.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(o.LoadingIndicatorPage,null)):h>0?e.createElement(G.i,{colCount:5,rowCount:h+1,footer:e.createElement(Q.c,{onClick:()=>C?S("create"):{},icon:e.createElement(f.Z,null)},n({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"}))},e.createElement(Y.h,null,e.createElement(Z.Tr,null,e.createElement(l.Th,null,e.createElement(P.C,{"aria-label":n({id:"global.select-all-entries",defaultMessage:"Select all entries"}),indeterminate:u>0&&u<h,value:u===h,onValueChange:he})),e.createElement(l.Th,{width:"20%"},e.createElement(i.Z,{variant:"sigma",textColor:"neutral600"},n({id:"global.name",defaultMessage:"Name"}))),e.createElement(l.Th,{width:"60%"},e.createElement(i.Z,{variant:"sigma",textColor:"neutral600"},n({id:"Settings.webhooks.form.url",defaultMessage:"URL"}))),e.createElement(l.Th,{width:"20%"},e.createElement(i.Z,{variant:"sigma",textColor:"neutral600"},n({id:"Settings.webhooks.list.th.status",defaultMessage:"Status"}))),e.createElement(l.Th,null,e.createElement(K.T,null,n({id:"Settings.webhooks.list.th.actions",defaultMessage:"Actions"}))))),e.createElement(J.p,null,d.map(a=>e.createElement(Z.Tr,{key:a.id,...(0,o.onRowClick)({fn:()=>S(a.id),condition:W})},e.createElement(l.Td,{...o.stopPropagation},e.createElement(P.C,{"aria-label":`${n({id:"global.select",defaultMessage:"Select"})} ${a.name}`,value:b?.includes(a.id),onValueChange:s=>Ee(s,a.id),name:"select"})),e.createElement(l.Td,null,e.createElement(i.Z,{fontWeight:"semiBold",textColor:"neutral800"},a.name)),e.createElement(l.Td,null,e.createElement(i.Z,{textColor:"neutral800"},a.url)),e.createElement(l.Td,null,e.createElement(x.k,null,e.createElement(X.r,{onLabel:n({id:"global.enabled",defaultMessage:"Enabled"}),offLabel:n({id:"global.disabled",defaultMessage:"Disabled"}),label:`${a.name} ${n({id:"Settings.webhooks.list.th.status",defaultMessage:"Status"})}`,selected:a.isEnabled,onChange:s=>{s.stopPropagation(),me.mutate({isEnabled:!a.isEnabled,id:a.id})},visibleLabels:!0}))),e.createElement(l.Td,null,e.createElement(x.k,{gap:1},W&&e.createElement(D.h,{label:n({id:"Settings.webhooks.events.update",defaultMessage:"Update"}),icon:e.createElement(_.Z,null),noBorder:!0}),V&&e.createElement(D.h,{onClick:s=>{s.stopPropagation(),r([a.id]),c(!0)},label:n({id:"Settings.webhooks.events.delete",defaultMessage:"Delete webhook"}),icon:e.createElement(A.Z,null),noBorder:!0}))))))):e.createElement(q.x,{icon:e.createElement(ee.Z,{width:"160px"}),content:n({id:"Settings.webhooks.list.empty.description",defaultMessage:"No webhooks found"}),action:e.createElement(k.z,{variant:"secondary",startIcon:e.createElement(f.Z,null),onClick:()=>C?S("create"):{}},n({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"}))}))),e.createElement(o.ConfirmDialog,{isOpen:se,onToggleDialog:()=>c(a=>!a),onConfirm:ge,isConfirmButtonLoading:N.isLoading}))},ne=()=>e.createElement(o.CheckPagePermissions,{permissions:w.Z.settings.webhooks.main},e.createElement(ae,null))}}]);
